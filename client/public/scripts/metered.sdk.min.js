(()=>{var ic=Object.create,ni=Object.defineProperty,sc=Object.getPrototypeOf,nc=Object.prototype.hasOwnProperty,ac=Object.getOwnPropertyNames,oc=Object.getOwnPropertyDescriptor;var cc=i=>ni(i,"__esModule",{value:!0});var m=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var dc=(i,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ac(e))!nc.call(i,r)&&r!=="default"&&ni(i,r,{get:()=>e[r],enumerable:!(t=oc(e,r))||t.enumerable});return i},Lt=i=>dc(cc(ni(i!=null?ic(sc(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var oi=m((At,ai)=>{(function(i,e){typeof At=="object"&&typeof ai=="object"?ai.exports=e():typeof define=="function"&&define.amd?define([],e):typeof At=="object"?At.bowser=e():i.bowser=e()})(At,function(){return function(i){var e={};function t(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return i[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=i,t.c=e,t.d=function(r,s,n){t.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:n})},t.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,s){if(1&s&&(r=t(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var c in r)t.d(n,c,function(a){return r[a]}.bind(null,c));return n},t.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(s,"a",s),s},t.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},t.p="",t(t.s=90)}({17:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r=t(18),s=function(){function n(){}return n.getFirstMatch=function(c,a){var o=a.match(c);return o&&o.length>0&&o[1]||""},n.getSecondMatch=function(c,a){var o=a.match(c);return o&&o.length>1&&o[2]||""},n.matchAndReturnConst=function(c,a,o){if(c.test(a))return o},n.getWindowsVersionName=function(c){switch(c){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},n.getMacOSVersionName=function(c){var a=c.split(".").splice(0,2).map(function(o){return parseInt(o,10)||0});if(a.push(0),a[0]===10)switch(a[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},n.getAndroidVersionName=function(c){var a=c.split(".").splice(0,2).map(function(o){return parseInt(o,10)||0});if(a.push(0),!(a[0]===1&&a[1]<5))return a[0]===1&&a[1]<6?"Cupcake":a[0]===1&&a[1]>=6?"Donut":a[0]===2&&a[1]<2?"Eclair":a[0]===2&&a[1]===2?"Froyo":a[0]===2&&a[1]>2?"Gingerbread":a[0]===3?"Honeycomb":a[0]===4&&a[1]<1?"Ice Cream Sandwich":a[0]===4&&a[1]<4?"Jelly Bean":a[0]===4&&a[1]>=4?"KitKat":a[0]===5?"Lollipop":a[0]===6?"Marshmallow":a[0]===7?"Nougat":a[0]===8?"Oreo":a[0]===9?"Pie":void 0},n.getVersionPrecision=function(c){return c.split(".").length},n.compareVersions=function(c,a,o){o===void 0&&(o=!1);var d=n.getVersionPrecision(c),p=n.getVersionPrecision(a),l=Math.max(d,p),u=0,h=n.map([c,a],function(f){var _=l-n.getVersionPrecision(f),g=f+new Array(_+1).join(".0");return n.map(g.split("."),function(M){return new Array(20-M.length).join("0")+M}).reverse()});for(o&&(u=l-Math.min(d,p)),l-=1;l>=u;){if(h[0][l]>h[1][l])return 1;if(h[0][l]===h[1][l]){if(l===u)return 0;l-=1}else if(h[0][l]<h[1][l])return-1}},n.map=function(c,a){var o,d=[];if(Array.prototype.map)return Array.prototype.map.call(c,a);for(o=0;o<c.length;o+=1)d.push(a(c[o]));return d},n.find=function(c,a){var o,d;if(Array.prototype.find)return Array.prototype.find.call(c,a);for(o=0,d=c.length;o<d;o+=1){var p=c[o];if(a(p,o))return p}},n.assign=function(c){for(var a,o,d=c,p=arguments.length,l=new Array(p>1?p-1:0),u=1;u<p;u++)l[u-1]=arguments[u];if(Object.assign)return Object.assign.apply(Object,[c].concat(l));var h=function(){var f=l[a];typeof f=="object"&&f!==null&&Object.keys(f).forEach(function(_){d[_]=f[_]})};for(a=0,o=l.length;a<o;a+=1)h();return c},n.getBrowserAlias=function(c){return r.BROWSER_ALIASES_MAP[c]},n.getBrowserTypeByAlias=function(c){return r.BROWSER_MAP[c]||""},n}();e.default=s,i.exports=e.default},18:function(i,e,t){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,s=(r=t(91))&&r.__esModule?r:{default:r},n=t(18);function c(o,d){for(var p=0;p<d.length;p++){var l=d[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,l.key,l)}}var a=function(){function o(){}var d,p,l;return o.getParser=function(u,h){if(h===void 0&&(h=!1),typeof u!="string")throw new Error("UserAgent should be a string");return new s.default(u,h)},o.parse=function(u){return new s.default(u).getResult()},d=o,l=[{key:"BROWSER_MAP",get:function(){return n.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return n.ENGINE_MAP}},{key:"OS_MAP",get:function(){return n.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return n.PLATFORMS_MAP}}],(p=null)&&c(d.prototype,p),l&&c(d,l),o}();e.default=a,i.exports=e.default},91:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r=o(t(92)),s=o(t(93)),n=o(t(94)),c=o(t(95)),a=o(t(17));function o(p){return p&&p.__esModule?p:{default:p}}var d=function(){function p(u,h){if(h===void 0&&(h=!1),u==null||u==="")throw new Error("UserAgent parameter can't be empty");this._ua=u,this.parsedResult={},h!==!0&&this.parse()}var l=p.prototype;return l.getUA=function(){return this._ua},l.test=function(u){return u.test(this._ua)},l.parseBrowser=function(){var u=this;this.parsedResult.browser={};var h=a.default.find(r.default,function(f){if(typeof f.test=="function")return f.test(u);if(f.test instanceof Array)return f.test.some(function(_){return u.test(_)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.browser=h.describe(this.getUA())),this.parsedResult.browser},l.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},l.getBrowserName=function(u){return u?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},l.getBrowserVersion=function(){return this.getBrowser().version},l.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},l.parseOS=function(){var u=this;this.parsedResult.os={};var h=a.default.find(s.default,function(f){if(typeof f.test=="function")return f.test(u);if(f.test instanceof Array)return f.test.some(function(_){return u.test(_)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.os=h.describe(this.getUA())),this.parsedResult.os},l.getOSName=function(u){var h=this.getOS().name;return u?String(h).toLowerCase()||"":h||""},l.getOSVersion=function(){return this.getOS().version},l.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},l.getPlatformType=function(u){u===void 0&&(u=!1);var h=this.getPlatform().type;return u?String(h).toLowerCase()||"":h||""},l.parsePlatform=function(){var u=this;this.parsedResult.platform={};var h=a.default.find(n.default,function(f){if(typeof f.test=="function")return f.test(u);if(f.test instanceof Array)return f.test.some(function(_){return u.test(_)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.platform=h.describe(this.getUA())),this.parsedResult.platform},l.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},l.getEngineName=function(u){return u?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},l.parseEngine=function(){var u=this;this.parsedResult.engine={};var h=a.default.find(c.default,function(f){if(typeof f.test=="function")return f.test(u);if(f.test instanceof Array)return f.test.some(function(_){return u.test(_)});throw new Error("Browser's test function is not valid")});return h&&(this.parsedResult.engine=h.describe(this.getUA())),this.parsedResult.engine},l.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},l.getResult=function(){return a.default.assign({},this.parsedResult)},l.satisfies=function(u){var h=this,f={},_=0,g={},M=0;if(Object.keys(u).forEach(function(K){var it=u[K];typeof it=="string"?(g[K]=it,M+=1):typeof it=="object"&&(f[K]=it,_+=1)}),_>0){var L=Object.keys(f),z=a.default.find(L,function(K){return h.isOS(K)});if(z){var xe=this.satisfies(f[z]);if(xe!==void 0)return xe}var Ne=a.default.find(L,function(K){return h.isPlatform(K)});if(Ne){var Ve=this.satisfies(f[Ne]);if(Ve!==void 0)return Ve}}if(M>0){var rt=Object.keys(g),Ot=a.default.find(rt,function(K){return h.isBrowser(K,!0)});if(Ot!==void 0)return this.compareVersion(g[Ot])}},l.isBrowser=function(u,h){h===void 0&&(h=!1);var f=this.getBrowserName().toLowerCase(),_=u.toLowerCase(),g=a.default.getBrowserTypeByAlias(_);return h&&g&&(_=g.toLowerCase()),_===f},l.compareVersion=function(u){var h=[0],f=u,_=!1,g=this.getBrowserVersion();if(typeof g=="string")return u[0]===">"||u[0]==="<"?(f=u.substr(1),u[1]==="="?(_=!0,f=u.substr(2)):h=[],u[0]===">"?h.push(1):h.push(-1)):u[0]==="="?f=u.substr(1):u[0]==="~"&&(_=!0,f=u.substr(1)),h.indexOf(a.default.compareVersions(g,f,_))>-1},l.isOS=function(u){return this.getOSName(!0)===String(u).toLowerCase()},l.isPlatform=function(u){return this.getPlatformType(!0)===String(u).toLowerCase()},l.isEngine=function(u){return this.getEngineName(!0)===String(u).toLowerCase()},l.is=function(u,h){return h===void 0&&(h=!1),this.isBrowser(u,h)||this.isOS(u)||this.isPlatform(u)},l.some=function(u){var h=this;return u===void 0&&(u=[]),u.some(function(f){return h.is(f)})},p}();e.default=d,i.exports=e.default},92:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,s=(r=t(17))&&r.__esModule?r:{default:r},n=/version\/(\d+(\.?_?\d+)+)/i,c=[{test:[/googlebot/i],describe:function(a){var o={name:"Googlebot"},d=s.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/opera/i],describe:function(a){var o={name:"Opera"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/opr\/|opios/i],describe:function(a){var o={name:"Opera"},d=s.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/SamsungBrowser/i],describe:function(a){var o={name:"Samsung Internet for Android"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/Whale/i],describe:function(a){var o={name:"NAVER Whale Browser"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/MZBrowser/i],describe:function(a){var o={name:"MZ Browser"},d=s.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/focus/i],describe:function(a){var o={name:"Focus"},d=s.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/swing/i],describe:function(a){var o={name:"Swing"},d=s.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/coast/i],describe:function(a){var o={name:"Opera Coast"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(a){var o={name:"Opera Touch"},d=s.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/yabrowser/i],describe:function(a){var o={name:"Yandex Browser"},d=s.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/ucbrowser/i],describe:function(a){var o={name:"UC Browser"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/Maxthon|mxios/i],describe:function(a){var o={name:"Maxthon"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/epiphany/i],describe:function(a){var o={name:"Epiphany"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/puffin/i],describe:function(a){var o={name:"Puffin"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/sleipnir/i],describe:function(a){var o={name:"Sleipnir"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/k-meleon/i],describe:function(a){var o={name:"K-Meleon"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/micromessenger/i],describe:function(a){var o={name:"WeChat"},d=s.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/qqbrowser/i],describe:function(a){var o={name:/qqbrowserlite/i.test(a)?"QQ Browser Lite":"QQ Browser"},d=s.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/msie|trident/i],describe:function(a){var o={name:"Internet Explorer"},d=s.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/\sedg\//i],describe:function(a){var o={name:"Microsoft Edge"},d=s.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/edg([ea]|ios)/i],describe:function(a){var o={name:"Microsoft Edge"},d=s.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/vivaldi/i],describe:function(a){var o={name:"Vivaldi"},d=s.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/seamonkey/i],describe:function(a){var o={name:"SeaMonkey"},d=s.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/sailfish/i],describe:function(a){var o={name:"Sailfish"},d=s.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,a);return d&&(o.version=d),o}},{test:[/silk/i],describe:function(a){var o={name:"Amazon Silk"},d=s.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/phantom/i],describe:function(a){var o={name:"PhantomJS"},d=s.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/slimerjs/i],describe:function(a){var o={name:"SlimerJS"},d=s.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var o={name:"BlackBerry"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var o={name:"WebOS Browser"},d=s.default.getFirstMatch(n,a)||s.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/bada/i],describe:function(a){var o={name:"Bada"},d=s.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/tizen/i],describe:function(a){var o={name:"Tizen"},d=s.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/qupzilla/i],describe:function(a){var o={name:"QupZilla"},d=s.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/firefox|iceweasel|fxios/i],describe:function(a){var o={name:"Firefox"},d=s.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/electron/i],describe:function(a){var o={name:"Electron"},d=s.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/MiuiBrowser/i],describe:function(a){var o={name:"Miui"},d=s.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/chromium/i],describe:function(a){var o={name:"Chromium"},d=s.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,a)||s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/chrome|crios|crmo/i],describe:function(a){var o={name:"Chrome"},d=s.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/GSA/i],describe:function(a){var o={name:"Google Search"},d=s.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:function(a){var o=!a.test(/like android/i),d=a.test(/android/i);return o&&d},describe:function(a){var o={name:"Android Browser"},d=s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/playstation 4/i],describe:function(a){var o={name:"PlayStation 4"},d=s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/safari|applewebkit/i],describe:function(a){var o={name:"Safari"},d=s.default.getFirstMatch(n,a);return d&&(o.version=d),o}},{test:[/.*/i],describe:function(a){var o=a.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:s.default.getFirstMatch(o,a),version:s.default.getSecondMatch(o,a)}}}];e.default=c,i.exports=e.default},93:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,s=(r=t(17))&&r.__esModule?r:{default:r},n=t(18),c=[{test:[/Roku\/DVP/],describe:function(a){var o=s.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,a);return{name:n.OS_MAP.Roku,version:o}}},{test:[/windows phone/i],describe:function(a){var o=s.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,a);return{name:n.OS_MAP.WindowsPhone,version:o}}},{test:[/windows /i],describe:function(a){var o=s.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,a),d=s.default.getWindowsVersionName(o);return{name:n.OS_MAP.Windows,version:o,versionName:d}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(a){var o={name:n.OS_MAP.iOS},d=s.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,a);return d&&(o.version=d),o}},{test:[/macintosh/i],describe:function(a){var o=s.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,a).replace(/[_\s]/g,"."),d=s.default.getMacOSVersionName(o),p={name:n.OS_MAP.MacOS,version:o};return d&&(p.versionName=d),p}},{test:[/(ipod|iphone|ipad)/i],describe:function(a){var o=s.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,a).replace(/[_\s]/g,".");return{name:n.OS_MAP.iOS,version:o}}},{test:function(a){var o=!a.test(/like android/i),d=a.test(/android/i);return o&&d},describe:function(a){var o=s.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,a),d=s.default.getAndroidVersionName(o),p={name:n.OS_MAP.Android,version:o};return d&&(p.versionName=d),p}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var o=s.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,a),d={name:n.OS_MAP.WebOS};return o&&o.length&&(d.version=o),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var o=s.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,a)||s.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,a)||s.default.getFirstMatch(/\bbb(\d+)/i,a);return{name:n.OS_MAP.BlackBerry,version:o}}},{test:[/bada/i],describe:function(a){var o=s.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,a);return{name:n.OS_MAP.Bada,version:o}}},{test:[/tizen/i],describe:function(a){var o=s.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,a);return{name:n.OS_MAP.Tizen,version:o}}},{test:[/linux/i],describe:function(){return{name:n.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:n.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(a){var o=s.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,a);return{name:n.OS_MAP.PlayStation4,version:o}}}];e.default=c,i.exports=e.default},94:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,s=(r=t(17))&&r.__esModule?r:{default:r},n=t(18),c=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(a){var o=s.default.getFirstMatch(/(can-l01)/i,a)&&"Nova",d={type:n.PLATFORMS_MAP.mobile,vendor:"Huawei"};return o&&(d.model=o),d}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:n.PLATFORMS_MAP.tablet}}},{test:function(a){var o=a.test(/ipod|iphone/i),d=a.test(/like (ipod|iphone)/i);return o&&!d},describe:function(a){var o=s.default.getFirstMatch(/(ipod|iphone)/i,a);return{type:n.PLATFORMS_MAP.mobile,vendor:"Apple",model:o}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:n.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:n.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getBrowserName(!0)==="blackberry"},describe:function(){return{type:n.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(a){return a.getBrowserName(!0)==="bada"},describe:function(){return{type:n.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getBrowserName()==="windows phone"},describe:function(){return{type:n.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(a){var o=Number(String(a.getOSVersion()).split(".")[0]);return a.getOSName(!0)==="android"&&o>=3},describe:function(){return{type:n.PLATFORMS_MAP.tablet}}},{test:function(a){return a.getOSName(!0)==="android"},describe:function(){return{type:n.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getOSName(!0)==="macos"},describe:function(){return{type:n.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(a){return a.getOSName(!0)==="windows"},describe:function(){return{type:n.PLATFORMS_MAP.desktop}}},{test:function(a){return a.getOSName(!0)==="linux"},describe:function(){return{type:n.PLATFORMS_MAP.desktop}}},{test:function(a){return a.getOSName(!0)==="playstation 4"},describe:function(){return{type:n.PLATFORMS_MAP.tv}}},{test:function(a){return a.getOSName(!0)==="roku"},describe:function(){return{type:n.PLATFORMS_MAP.tv}}}];e.default=c,i.exports=e.default},95:function(i,e,t){"use strict";e.__esModule=!0,e.default=void 0;var r,s=(r=t(17))&&r.__esModule?r:{default:r},n=t(18),c=[{test:function(a){return a.getBrowserName(!0)==="microsoft edge"},describe:function(a){if(/\sedg\//i.test(a))return{name:n.ENGINE_MAP.Blink};var o=s.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,a);return{name:n.ENGINE_MAP.EdgeHTML,version:o}}},{test:[/trident/i],describe:function(a){var o={name:n.ENGINE_MAP.Trident},d=s.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:function(a){return a.test(/presto/i)},describe:function(a){var o={name:n.ENGINE_MAP.Presto},d=s.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:function(a){var o=a.test(/gecko/i),d=a.test(/like gecko/i);return o&&!d},describe:function(a){var o={name:n.ENGINE_MAP.Gecko},d=s.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:n.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(a){var o={name:n.ENGINE_MAP.WebKit},d=s.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,a);return d&&(o.version=d),o}}];e.default=c,i.exports=e.default}})})});var ci=m((Xu,_s)=>{var pc=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,lc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];_s.exports=function(e){var t=e,r=e.indexOf("["),s=e.indexOf("]");r!=-1&&s!=-1&&(e=e.substring(0,r)+e.substring(r,s).replace(/:/g,";")+e.substring(s,e.length));for(var n=pc.exec(e||""),c={},a=14;a--;)c[lc[a]]=n[a]||"";return r!=-1&&s!=-1&&(c.source=t,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0),c.pathNames=uc(c,c.path),c.queryKey=hc(c,c.query),c};function uc(i,e){var t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function hc(i,e){var t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,s,n){s&&(t[s]=n)}),t}});var ys=m((Yu,vs)=>{var st=1e3,nt=st*60,at=nt*60,Je=at*24,fc=Je*7,mc=Je*365.25;vs.exports=function(i,e){e=e||{};var t=typeof i;if(t==="string"&&i.length>0)return gc(i);if(t==="number"&&isFinite(i))return e.long?vc(i):_c(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))};function gc(i){if(i=String(i),!(i.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(!!e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*mc;case"weeks":case"week":case"w":return t*fc;case"days":case"day":case"d":return t*Je;case"hours":case"hour":case"hrs":case"hr":case"h":return t*at;case"minutes":case"minute":case"mins":case"min":case"m":return t*nt;case"seconds":case"second":case"secs":case"sec":case"s":return t*st;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function _c(i){var e=Math.abs(i);return e>=Je?Math.round(i/Je)+"d":e>=at?Math.round(i/at)+"h":e>=nt?Math.round(i/nt)+"m":e>=st?Math.round(i/st)+"s":i+"ms"}function vc(i){var e=Math.abs(i);return e>=Je?nr(i,e,Je,"day"):e>=at?nr(i,e,at,"hour"):e>=nt?nr(i,e,nt,"minute"):e>=st?nr(i,e,st,"second"):i+" ms"}function nr(i,e,t,r){var s=e>=t*1.5;return Math.round(i/t)+" "+r+(s?"s":"")}});var ws=m((Zu,Ss)=>{function yc(i){t.debug=t,t.default=t,t.coerce=o,t.disable=n,t.enable=s,t.enabled=c,t.humanize=ys(),t.destroy=d,Object.keys(i).forEach(p=>{t[p]=i[p]}),t.names=[],t.skips=[],t.formatters={};function e(p){let l=0;for(let u=0;u<p.length;u++)l=(l<<5)-l+p.charCodeAt(u),l|=0;return t.colors[Math.abs(l)%t.colors.length]}t.selectColor=e;function t(p){let l,u=null;function h(...f){if(!h.enabled)return;let _=h,g=Number(new Date),M=g-(l||g);_.diff=M,_.prev=l,_.curr=g,l=g,f[0]=t.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");let L=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,(xe,Ne)=>{if(xe==="%%")return"%";L++;let Ve=t.formatters[Ne];if(typeof Ve=="function"){let rt=f[L];xe=Ve.call(_,rt),f.splice(L,1),L--}return xe}),t.formatArgs.call(_,f),(_.log||t.log).apply(_,f)}return h.namespace=p,h.useColors=t.useColors(),h.color=t.selectColor(p),h.extend=r,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>u===null?t.enabled(p):u,set:f=>{u=f}}),typeof t.init=="function"&&t.init(h),h}function r(p,l){let u=t(this.namespace+(typeof l=="undefined"?":":l)+p);return u.log=this.log,u}function s(p){t.save(p),t.names=[],t.skips=[];let l,u=(typeof p=="string"?p:"").split(/[\s,]+/),h=u.length;for(l=0;l<h;l++)!u[l]||(p=u[l].replace(/\*/g,".*?"),p[0]==="-"?t.skips.push(new RegExp("^"+p.substr(1)+"$")):t.names.push(new RegExp("^"+p+"$")))}function n(){let p=[...t.names.map(a),...t.skips.map(a).map(l=>"-"+l)].join(",");return t.enable(""),p}function c(p){if(p[p.length-1]==="*")return!0;let l,u;for(l=0,u=t.skips.length;l<u;l++)if(t.skips[l].test(p))return!1;for(l=0,u=t.names.length;l<u;l++)if(t.names[l].test(p))return!0;return!1}function a(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function o(p){return p instanceof Error?p.stack||p.message:p}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Ss.exports=yc});var X=m((Q,ar)=>{Q.formatArgs=Sc;Q.save=wc;Q.load=bc;Q.useColors=Rc;Q.storage=Tc();Q.destroy=(()=>{let i=!1;return()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Q.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Rc(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Sc(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+ar.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;i.splice(1,0,e,"color: inherit");let t=0,r=0;i[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(r=t))}),i.splice(r,0,e)}Q.log=console.debug||console.log||(()=>{});function wc(i){try{i?Q.storage.setItem("debug",i):Q.storage.removeItem("debug")}catch(e){}}function bc(){let i;try{i=Q.storage.getItem("debug")}catch(e){}return!i&&typeof process!="undefined"&&"env"in process&&(i=process.env.DEBUG),i}function Tc(){try{return localStorage}catch(i){}}ar.exports=ws()(Q);var{formatters:Pc}=ar.exports;Pc.j=function(i){try{return JSON.stringify(i)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Rs=m(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.url=void 0;var Cc=ci(),bs=X()("socket.io-client:url");function Ec(i,e="",t){let r=i;t=t||typeof location!="undefined"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(bs("protocol-less url %s",i),typeof t!="undefined"?i=t.protocol+"//"+i:i="https://"+i),bs("parse %s",i),r=Cc(i)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let n=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port+e,r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port),r}or.url=Ec});var Ts=m((th,di)=>{try{di.exports=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(i){di.exports=!1}});var jt=m((rh,Ps)=>{Ps.exports=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())()});var pi=m((ih,Cs)=>{var Dc=Ts(),kc=jt();Cs.exports=function(i){let e=i.xdomain,t=i.xscheme,r=i.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!e||Dc))return new XMLHttpRequest}catch(s){}try{if(typeof XDomainRequest!="undefined"&&!t&&r)return new XDomainRequest}catch(s){}if(!e)try{return new kc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(s){}}});var li=m((sh,Es)=>{var le=Object.create(null);le.open="0";le.close="1";le.ping="2";le.pong="3";le.message="4";le.upgrade="5";le.noop="6";var Ds=Object.create(null);Object.keys(le).forEach(i=>{Ds[le[i]]=i});var Ic={type:"error",data:"parser error"};Es.exports={PACKET_TYPES:le,PACKET_TYPES_REVERSE:Ds,ERROR_PACKET:Ic}});var Ms=m((nh,ks)=>{var{PACKET_TYPES:Mc}=li(),xc=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Oc=typeof ArrayBuffer=="function",Lc=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,Ac=({type:i,data:e},t,r)=>xc&&e instanceof Blob?t?r(e):Is(e,r):Oc&&(e instanceof ArrayBuffer||Lc(e))?t?r(e instanceof ArrayBuffer?e:e.buffer):Is(new Blob([e]),r):r(Mc[i]+(e||"")),Is=(i,e)=>{let t=new FileReader;return t.onload=function(){let r=t.result.split(",")[1];e("b"+r)},t.readAsDataURL(i)};ks.exports=Ac});var xs=m(ui=>{(function(i){"use strict";ui.encode=function(e){var t=new Uint8Array(e),r,s=t.length,n="";for(r=0;r<s;r+=3)n+=i[t[r]>>2],n+=i[(t[r]&3)<<4|t[r+1]>>4],n+=i[(t[r+1]&15)<<2|t[r+2]>>6],n+=i[t[r+2]&63];return s%3==2?n=n.substring(0,n.length-1)+"=":s%3==1&&(n=n.substring(0,n.length-2)+"=="),n},ui.decode=function(e){var t=e.length*.75,r=e.length,s,n=0,c,a,o,d;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var p=new ArrayBuffer(t),l=new Uint8Array(p);for(s=0;s<r;s+=4)c=i.indexOf(e[s]),a=i.indexOf(e[s+1]),o=i.indexOf(e[s+2]),d=i.indexOf(e[s+3]),l[n++]=c<<2|a>>4,l[n++]=(a&15)<<4|o>>2,l[n++]=(o&3)<<6|d&63;return p}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")});var As=m((oh,Os)=>{var{PACKET_TYPES_REVERSE:hi,ERROR_PACKET:jc}=li(),Bc=typeof ArrayBuffer=="function",fi;Bc&&(fi=xs());var Fc=(i,e)=>{if(typeof i!="string")return{type:"message",data:Ls(i,e)};let t=i.charAt(0);return t==="b"?{type:"message",data:qc(i.substring(1),e)}:hi[t]?i.length>1?{type:hi[t],data:i.substring(1)}:{type:hi[t]}:jc},qc=(i,e)=>{if(fi){let t=fi.decode(i);return Ls(t,e)}else return{base64:!0,data:i}},Ls=(i,e)=>{switch(e){case"blob":return i instanceof ArrayBuffer?new Blob([i]):i;case"arraybuffer":default:return i}};Os.exports=Fc});var ot=m((ch,js)=>{var Bs=Ms(),qs=As(),Fs=String.fromCharCode(30),Nc=(i,e)=>{let t=i.length,r=new Array(t),s=0;i.forEach((n,c)=>{Bs(n,!1,a=>{r[c]=a,++s===t&&e(r.join(Fs))})})},Vc=(i,e)=>{let t=i.split(Fs),r=[];for(let s=0;s<t.length;s++){let n=qs(t[s],e);if(r.push(n),n.type==="error")break}return r};js.exports={protocol:4,encodePacket:Bs,encodePayload:Nc,decodePacket:qs,decodePayload:Vc}});var ct=m((dh,mi)=>{typeof mi!="undefined"&&(mi.exports=Y);function Y(i){if(i)return Uc(i)}function Uc(i){for(var e in Y.prototype)i[e]=Y.prototype[e];return i}Y.prototype.on=Y.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};Y.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};Y.prototype.off=Y.prototype.removeListener=Y.prototype.removeAllListeners=Y.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var r,s=0;s<t.length;s++)if(r=t[s],r===e||r.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+i],this};Y.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,s=t.length;r<s;++r)t[r].apply(this,e)}return this};Y.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};Y.prototype.hasListeners=function(i){return!!this.listeners(i).length}});var cr=m((ph,Ns)=>{var zc=ot(),$c=ct(),Hc=X()("engine.io-client:transport"),Vs=class extends $c{constructor(e){super();this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){let r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"?this.write(e):Hc("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(e){let t=zc.decodePacket(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){this.emit("packet",e)}onClose(){this.readyState="closed",this.emit("close")}};Ns.exports=Vs});var dr=m(gi=>{gi.encode=function(i){var e="";for(var t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e};gi.decode=function(i){for(var e={},t=i.split("&"),r=0,s=t.length;r<s;r++){var n=t[r].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}});var yi=m((uh,Us)=>{"use strict";var zs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),pr=64,$s={},Hs=0,Ue=0,Ks;function _i(i){var e="";do e=zs[i%pr]+e,i=Math.floor(i/pr);while(i>0);return e}function Kc(i){var e=0;for(Ue=0;Ue<i.length;Ue++)e=e*pr+$s[i.charAt(Ue)];return e}function vi(){var i=_i(+new Date);return i!==Ks?(Hs=0,Ks=i):i+"."+_i(Hs++)}for(;Ue<pr;Ue++)$s[zs[Ue]]=Ue;vi.encode=_i;vi.decode=Kc;Us.exports=vi});var Si=m((hh,Gs)=>{var Gc=cr(),Jc=dr(),Js=ot(),Wc=yi(),ae=X()("engine.io-client:polling"),Ws=class extends Gc{get name(){return"polling"}doOpen(){this.poll()}pause(e){let t=this;this.readyState="pausing";function r(){ae("paused"),t.readyState="paused",e()}if(this.polling||!this.writable){let s=0;this.polling&&(ae("we are currently polling - waiting to pause"),s++,this.once("pollComplete",function(){ae("pre-pause polling complete"),--s||r()})),this.writable||(ae("we are currently writing - waiting to pause"),s++,this.once("drain",function(){ae("pre-pause writing complete"),--s||r()}))}else r()}poll(){ae("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){let t=this;ae("polling got data %s",e);let r=function(s,n,c){if(t.readyState==="opening"&&s.type==="open"&&t.onOpen(),s.type==="close")return t.onClose(),!1;t.onPacket(s)};Js.decodePayload(e,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():ae('ignoring poll - transport state "%s"',this.readyState))}doClose(){let e=this;function t(){ae("writing close packet"),e.write([{type:"close"}])}this.readyState==="open"?(ae("transport open - closing"),t()):(ae("transport not open - deferring close"),this.once("open",t))}write(e){this.writable=!1,Js.encodePayload(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emit("drain")})})}uri(){let e=this.query||{},t=this.opts.secure?"https":"http",r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Wc()),!this.supportsBinary&&!e.sid&&(e.b64=1),e=Jc.encode(e),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),e.length&&(e="?"+e);let s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+e}};Gs.exports=Ws});var wi=m((fh,Qs)=>{Qs.exports.pick=(i,...e)=>e.reduce((t,r)=>(i.hasOwnProperty(r)&&(t[r]=i[r]),t),{})});var tn=m((mh,bi)=>{var Xs=pi(),Qc=Si(),Xc=ct(),{pick:Yc}=wi(),Zc=jt(),Ri=X()("engine.io-client:polling-xhr");function Ys(){}var ed=function(){return new Xs({xdomain:!1}).responseType!=null}(),Zs=class extends Qc{constructor(e){super(e);if(typeof location!="undefined"){let r=location.protocol==="https:",s=location.port;s||(s=r?443:80),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==r}let t=e&&e.forceBase64;this.supportsBinary=ed&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Z(this.uri(),e)}doWrite(e,t){let r=this.request({method:"POST",data:e}),s=this;r.on("success",t),r.on("error",function(n){s.onError("xhr post error",n)})}doPoll(){Ri("xhr poll");let e=this.request(),t=this;e.on("data",function(r){t.onData(r)}),e.on("error",function(r){t.onError("xhr poll error",r)}),this.pollXhr=e}},Z=class extends Xc{constructor(e,t){super();this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){let e=Yc(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;let t=this.xhr=new Xs(e),r=this;try{Ri("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&t.setRequestHeader(s,this.opts.extraHeaders[s])}}catch(s){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{t.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){t.readyState===4&&(t.status===200||t.status===1223?r.onLoad():setTimeout(function(){r.onError(typeof t.status=="number"?t.status:0)},0))},Ri("xhr data %s",this.data),t.send(this.data)}catch(s){setTimeout(function(){r.onError(s)},0);return}typeof document!="undefined"&&(this.index=Z.requestsCount++,Z.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=Ys:this.xhr.onreadystatechange=Ys,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete Z.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&this.onData(e)}hasXDR(){return typeof XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}};Z.requestsCount=0;Z.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",en);else if(typeof addEventListener=="function"){let i="onpagehide"in Zc?"pagehide":"unload";addEventListener(i,en,!1)}}function en(){for(let i in Z.requests)Z.requests.hasOwnProperty(i)&&Z.requests[i].abort()}bi.exports=Zs;bi.exports.Request=Z});var an=m((gh,rn)=>{var td=Si(),sn=jt(),rd=/\n/g,id=/\\n/g,lr,nn=class extends td{constructor(e){super(e);this.query=this.query||{},lr||(lr=sn.___eio=sn.___eio||[]),this.index=lr.length;let t=this;lr.push(function(r){t.onData(r)}),this.query.j=this.index}get supportsBinary(){return!1}doClose(){this.script&&(this.script.onerror=()=>{},this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){let e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(n){e.onError("jsonp poll error",n)};let r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){let n=document.createElement("iframe");document.body.appendChild(n),document.body.removeChild(n)},100)}doWrite(e,t){let r=this,s;if(!this.form){let a=document.createElement("form"),o=document.createElement("textarea"),d=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=d,a.method="POST",a.setAttribute("accept-charset","utf-8"),o.name="d",a.appendChild(o),document.body.appendChild(a),this.form=a,this.area=o}this.form.action=this.uri();function n(){c(),t()}function c(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(a){r.onError("jsonp polling iframe removal error",a)}try{let a='<iframe src="javascript:0" name="'+r.iframeId+'">';s=document.createElement(a)}catch(a){s=document.createElement("iframe"),s.name=r.iframeId,s.src="javascript:0"}s.id=r.iframeId,r.form.appendChild(s),r.iframe=s}c(),e=e.replace(id,`\\
`),this.area.value=e.replace(rd,"\\n");try{this.form.submit()}catch(a){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){r.iframe.readyState==="complete"&&n()}:this.iframe.onload=n}};rn.exports=nn});var dn=m((_h,on)=>{var cn=jt();on.exports={WebSocket:cn.WebSocket||cn.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer"}});var hn=m((vh,pn)=>{var ln=cr(),sd=ot(),nd=dr(),ad=yi(),{pick:od}=wi(),{WebSocket:Bt,usingBrowserWebSocket:Ti,defaultBinaryType:cd}=dn(),dd=X()("engine.io-client:websocket"),un=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",ur=class extends ln{constructor(e){super(e);this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,r=un?{}:od(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ti&&!un?t?new Bt(e,t):new Bt(e):new Bt(e,t,r)}catch(s){return this.emit("error",s)}this.ws.binaryType=this.socket.binaryType||cd,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){let t=this;this.writable=!1;let r=e.length,s=0,n=r;for(;s<n;s++)(function(a){sd.encodePacket(a,t.supportsBinary,function(o){let d={};Ti||(a.options&&(d.compress=a.options.compress),t.opts.perMessageDeflate&&(typeof o=="string"?Buffer.byteLength(o):o.length)<t.opts.perMessageDeflate.threshold&&(d.compress=!1));try{Ti?t.ws.send(o):t.ws.send(o,d)}catch(p){dd("websocket closed before onclose event")}--r||c()})})(e[s]);function c(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}}onClose(){ln.prototype.onClose.call(this)}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{},t=this.opts.secure?"wss":"ws",r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=ad()),this.supportsBinary||(e.b64=1),e=nd.encode(e),e.length&&(e="?"+e);let s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+e}check(){return!!Bt&&!("__initialize"in Bt&&this.name===ur.prototype.name)}};pn.exports=ur});var Ci=m(Pi=>{var pd=pi(),ld=tn(),ud=an(),hd=hn();Pi.polling=fd;Pi.websocket=hd;function fd(i){let e,t=!1,r=!1,s=i.jsonp!==!1;if(typeof location!="undefined"){let n=location.protocol==="https:",c=location.port;c||(c=n?443:80),t=i.hostname!==location.hostname||c!==i.port,r=i.secure!==n}if(i.xdomain=t,i.xscheme=r,e=new pd(i),"open"in e&&!i.forceJSONP)return new ld(i);if(!s)throw new Error("JSONP disabled");return new ud(i)}});var _n=m((Sh,fn)=>{var md=Ci(),gd=ct(),x=X()("engine.io-client:socket"),mn=ot(),gn=ci(),_d=dr(),ue=class extends gd{constructor(e,t={}){super();e&&typeof e=="object"&&(t=e,e=null),e?(e=gn(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=gn(t.host).host),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?443:80),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{}},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=_d.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){x('creating transport "%s"',e);let t=vd(this.opts.query);t.EIO=mn.protocol,t.transport=e,this.id&&(t.sid=this.id);let r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return x("options: %j",r),new md[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ue.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){let t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){x("error while creating transport: %s",t),this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){x("setting transport %s",e.name);let t=this;this.transport&&(x("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(r){t.onPacket(r)}).on("error",function(r){t.onError(r)}).on("close",function(){t.onClose("transport close")})}probe(e){x('probing transport "%s"',e);let t=this.createTransport(e,{probe:1}),r=!1,s=this;ue.priorWebsocketSuccess=!1;function n(){if(s.onlyBinaryUpgrades){let u=!this.supportsBinary&&s.transport.supportsBinary;r=r||u}r||(x('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(u){if(!r)if(u.type==="pong"&&u.data==="probe"){if(x('probe transport "%s" pong',e),s.upgrading=!0,s.emit("upgrading",t),!t)return;ue.priorWebsocketSuccess=t.name==="websocket",x('pausing current transport "%s"',s.transport.name),s.transport.pause(function(){r||s.readyState!=="closed"&&(x("changing transport and sending upgrade packet"),l(),s.setTransport(t),t.send([{type:"upgrade"}]),s.emit("upgrade",t),t=null,s.upgrading=!1,s.flush())})}else{x('probe transport "%s" failed',e);let h=new Error("probe error");h.transport=t.name,s.emit("upgradeError",h)}}))}function c(){r||(r=!0,l(),t.close(),t=null)}function a(u){let h=new Error("probe error: "+u);h.transport=t.name,c(),x('probe transport "%s" failed because of error: %s',e,u),s.emit("upgradeError",h)}function o(){a("transport closed")}function d(){a("socket closed")}function p(u){t&&u.name!==t.name&&(x('"%s" works - aborting "%s"',u.name,t.name),c())}function l(){t.removeListener("open",n),t.removeListener("error",a),t.removeListener("close",o),s.removeListener("close",d),s.removeListener("upgrading",p)}t.once("open",n),t.once("error",a),t.once("close",o),this.once("close",d),this.once("upgrading",p),t.open()}onOpen(){if(x("socket open"),this.readyState="open",ue.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){x("starting upgrade probes");let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(x('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data);break}else x('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(x("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,s){if(typeof t=="function"&&(s=t,t=void 0),typeof r=="function"&&(s=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;let n={type:e,data:t,options:r};this.emit("packetCreate",n),this.writeBuffer.push(n),s&&this.once("flush",s),this.flush()}close(){let e=this;(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){this.upgrading?s():t()}):this.upgrading?s():t());function t(){e.onClose("forced close"),x("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function s(){e.once("upgrade",r),e.once("upgradeError",r)}return this}onError(e){x("socket error %j",e),ue.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)}onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){x('socket close with reason: "%s"',e);let r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}}filterUpgrades(e){let t=[],r=0,s=e.length;for(;r<s;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}};ue.priorWebsocketSuccess=!1;ue.protocol=mn.protocol;function vd(i){let e={};for(let t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}fn.exports=ue});var vn=m((wh,We)=>{var Ei=_n();We.exports=(i,e)=>new Ei(i,e);We.exports.Socket=Ei;We.exports.protocol=Ei.protocol;We.exports.Transport=cr();We.exports.transports=Ci();We.exports.parser=ot()});var Di=m(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.hasBinary=dt.isBinary=void 0;var yd=typeof ArrayBuffer=="function",Sd=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,yn=Object.prototype.toString,wd=typeof Blob=="function"||typeof Blob!="undefined"&&yn.call(Blob)==="[object BlobConstructor]",bd=typeof File=="function"||typeof File!="undefined"&&yn.call(File)==="[object FileConstructor]";function Sn(i){return yd&&(i instanceof ArrayBuffer||Sd(i))||wd&&i instanceof Blob||bd&&i instanceof File}dt.isBinary=Sn;function hr(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,r=i.length;t<r;t++)if(hr(i[t]))return!0;return!1}if(Sn(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return hr(i.toJSON(),!0);for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&hr(i[t]))return!0;return!1}dt.hasBinary=hr});var wn=m(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.reconstructPacket=pt.deconstructPacket=void 0;var Rd=Di();function Td(i){let e=[],t=i.data,r=i;return r.data=ki(t,e),r.attachments=e.length,{packet:r,buffers:e}}pt.deconstructPacket=Td;function ki(i,e){if(!i)return i;if(Rd.isBinary(i)){let t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){let t=new Array(i.length);for(let r=0;r<i.length;r++)t[r]=ki(i[r],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){let t={};for(let r in i)i.hasOwnProperty(r)&&(t[r]=ki(i[r],e));return t}return i}function Pd(i,e){return i.data=Ii(i.data,e),i.attachments=void 0,i}pt.reconstructPacket=Pd;function Ii(i,e){if(!i)return i;if(i&&i._placeholder)return e[i.num];if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=Ii(i[t],e);else if(typeof i=="object")for(let t in i)i.hasOwnProperty(t)&&(i[t]=Ii(i[t],e));return i}});var mr=m(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.Decoder=oe.Encoder=oe.PacketType=oe.protocol=void 0;var Cd=ct(),bn=wn(),Rn=Di(),Mi=X()("socket.io-parser");oe.protocol=5;var O;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(O=oe.PacketType||(oe.PacketType={}));var Tn=class{encode(e){return Mi("encoding packet %j",e),(e.type===O.EVENT||e.type===O.ACK)&&Rn.hasBinary(e)?(e.type=e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===O.BINARY_EVENT||e.type===O.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data)),Mi("encoded %j as %s",e,t),t}encodeAsBinary(e){let t=bn.deconstructPacket(e),r=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(r),s}};oe.Encoder=Tn;var fr=class extends Cd{constructor(){super()}add(e){let t;if(typeof e=="string")t=this.decodeString(e),t.type===O.BINARY_EVENT||t.type===O.BINARY_ACK?(this.reconstructor=new Pn(t),t.attachments===0&&super.emit("decoded",t)):super.emit("decoded",t);else if(Rn.isBinary(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emit("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(O[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===O.BINARY_EVENT||r.type===O.BINARY_ACK){let n=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let c=e.substring(n,t);if(c!=Number(c)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(c)}if(e.charAt(t+1)==="/"){let n=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(n,t)}else r.nsp="/";let s=e.charAt(t+1);if(s!==""&&Number(s)==s){let n=t+1;for(;++t;){let c=e.charAt(t);if(c==null||Number(c)!=c){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){let n=Ed(e.substr(t));if(fr.isPayloadValid(r.type,n))r.data=n;else throw new Error("invalid payload")}return Mi("decoded %s as %j",e,r),r}static isPayloadValid(e,t){switch(e){case O.CONNECT:return typeof t=="object";case O.DISCONNECT:return t===void 0;case O.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case O.EVENT:case O.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case O.ACK:case O.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}};oe.Decoder=fr;function Ed(i){try{return JSON.parse(i)}catch(e){return!1}}var Pn=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=bn.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}});var xi=m(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.on=void 0;function Dd(i,e,t){return i.on(e,t),function(){i.off(e,t)}}gr.on=Dd});var Oi=m(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.StrictEventEmitter=void 0;var kd=ct(),Cn=class extends kd{on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}emit(e,...t){return super.emit(e,...t),this}emitReserved(e,...t){return super.emit(e,...t),this}listeners(e){return super.listeners(e)}};_r.StrictEventEmitter=Cn});var Li=m(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.Socket=void 0;var ee=mr(),yr=xi(),Id=Oi(),te=X()("socket.io-client:socket"),Md=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),En=class extends Id.StrictEventEmitter{constructor(e,t,r){super();this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;let e=this.io;this.subs=[yr.on(e,"open",this.onopen.bind(this)),yr.on(e,"packet",this.onpacket.bind(this)),yr.on(e,"error",this.onerror.bind(this)),yr.on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Md.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);let r={type:ee.PacketType.EVENT,data:t};r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"&&(te("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++);let s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)?te("discard packet as the transport is not currently writable"):this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){te("transport is open - connecting"),typeof this.auth=="function"?this.auth(e=>{this.packet({type:ee.PacketType.CONNECT,data:e})}):this.packet({type:ee.PacketType.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){te("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ee.PacketType.CONNECT:if(e.data&&e.data.sid){let s=e.data.sid;this.onconnect(s)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ee.PacketType.EVENT:this.onevent(e);break;case ee.PacketType.BINARY_EVENT:this.onevent(e);break;case ee.PacketType.ACK:this.onack(e);break;case ee.PacketType.BINARY_ACK:this.onack(e);break;case ee.PacketType.DISCONNECT:this.ondisconnect();break;case ee.PacketType.CONNECT_ERROR:let r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){let t=e.data||[];te("emitting event %j",t),e.id!=null&&(te("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e)}ack(e){let t=this,r=!1;return function(...s){r||(r=!0,te("sending ack %j",s),t.packet({type:ee.PacketType.ACK,id:e,data:s}))}}onack(e){let t=this.acks[e.id];typeof t=="function"?(te("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):te("bad ack %s",e.id)}onconnect(e){te("socket connected with id %s",e),this.id=e,this.connected=!0,this.disconnected=!1,this.emitReserved("connect"),this.emitBuffered()}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>this.packet(e)),this.sendBuffer=[]}ondisconnect(){te("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(te("performing disconnect (%s)",this.nsp),this.packet({type:ee.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}};vr.Socket=En});var kn=m((Dh,Dn)=>{Dn.exports=lt;function lt(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}lt.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-t:i+t}return Math.min(i,this.max)|0};lt.prototype.reset=function(){this.attempts=0};lt.prototype.setMin=function(i){this.ms=i};lt.prototype.setMax=function(i){this.max=i};lt.prototype.setJitter=function(i){this.jitter=i}});var Ai=m(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.Manager=void 0;var xd=vn(),Od=Li(),Ld=mr(),Qe=xi(),Ad=kn(),jd=Oi(),B=X()("socket.io-client:manager"),In=class extends jd.StrictEventEmitter{constructor(e,t){super();this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new Ad({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let r=t.parser||Ld;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(B("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;B("opening %s",this.uri),this.engine=xd(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let s=Qe.on(t,"open",function(){r.onopen(),e&&e()}),n=Qe.on(t,"error",c=>{B("error"),r.cleanup(),r._readyState="closed",this.emitReserved("error",c),e?e(c):r.maybeReconnectOnOpen()});if(this._timeout!==!1){let c=this._timeout;B("connect attempt will timeout after %d",c),c===0&&s();let a=setTimeout(()=>{B("connect attempt timed out after %d",c),s(),t.close(),t.emit("error",new Error("timeout"))},c);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(s),this.subs.push(n),this}connect(e){return this.open(e)}onopen(){B("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Qe.on(e,"ping",this.onping.bind(this)),Qe.on(e,"data",this.ondata.bind(this)),Qe.on(e,"error",this.onerror.bind(this)),Qe.on(e,"close",this.onclose.bind(this)),Qe.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){B("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r||(r=new Od.Socket(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t)if(this.nsps[r].active){B("socket %s is still active, skipping close",r);return}this._close()}_packet(e){B("writing packet %j",e);let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){B("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){B("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this._readyState==="opening"&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){B("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)B("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();B("will wait %dms before reconnect attempt",t),this._reconnecting=!0;let r=setTimeout(()=>{e.skipReconnect||(B("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(B("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):(B("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};Sr.Manager=In});var Ln=m((G,Mn)=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.Socket=G.io=G.Manager=G.protocol=void 0;var Bd=Rs(),xn=Ai(),qd=Li();Object.defineProperty(G,"Socket",{enumerable:!0,get:function(){return qd.Socket}});var On=X()("socket.io-client");Mn.exports=G=wr;var qt=G.managers={};function wr(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};let t=Bd.url(i,e.path),r=t.source,s=t.id,n=t.path,c=qt[s]&&n in qt[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||c,o;return a?(On("ignoring socket cache for %s",r),o=new xn.Manager(r,e)):(qt[s]||(On("new io instance for %s",r),qt[s]=new xn.Manager(r,e)),o=qt[s]),t.query&&!e.query&&(e.query=t.queryKey),o.socket(t.path,e)}G.io=wr;var Fd=mr();Object.defineProperty(G,"protocol",{enumerable:!0,get:function(){return Fd.protocol}});G.connect=wr;var Nd=Ai();Object.defineProperty(G,"Manager",{enumerable:!0,get:function(){return Nd.Manager}});G.default=wr});var A=m(ut=>{"use strict";var Vd=ut&&ut.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ut,"__esModule",{value:!0});ut.Logger=void 0;var ht=Vd(X()),ft="mediasoup-client",jn=class{constructor(e){e?(this._debug=ht.default(`${ft}:${e}`),this._warn=ht.default(`${ft}:WARN:${e}`),this._error=ht.default(`${ft}:ERROR:${e}`)):(this._debug=ht.default(ft),this._warn=ht.default(`${ft}:WARN`),this._error=ht.default(`${ft}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};ut.Logger=jn});var Gn=m((Lh,ji)=>{"use strict";var mt=typeof Reflect=="object"?Reflect:null,Bn=mt&&typeof mt.apply=="function"?mt.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Rr;mt&&typeof mt.ownKeys=="function"?Rr=mt.ownKeys:Object.getOwnPropertySymbols?Rr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Rr=function(e){return Object.getOwnPropertyNames(e)};function Ud(i){console&&console.warn&&console.warn(i)}var qn=Number.isNaN||function(e){return e!==e};function I(){I.init.call(this)}ji.exports=I;ji.exports.once=zd;I.EventEmitter=I;I.prototype._events=void 0;I.prototype._eventsCount=0;I.prototype._maxListeners=void 0;var Fn=10;function Tr(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(I,"defaultMaxListeners",{enumerable:!0,get:function(){return Fn},set:function(i){if(typeof i!="number"||i<0||qn(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Fn=i}});I.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};I.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||qn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Nn(i){return i._maxListeners===void 0?I.defaultMaxListeners:i._maxListeners}I.prototype.getMaxListeners=function(){return Nn(this)};I.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var s=e==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var c;if(t.length>0&&(c=t[0]),c instanceof Error)throw c;var a=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw a.context=c,a}var o=n[e];if(o===void 0)return!1;if(typeof o=="function")Bn(o,this,t);else for(var d=o.length,p=Vn(o,d),r=0;r<d;++r)Bn(p[r],this,t);return!0};function Un(i,e,t,r){var s,n,c;if(Tr(t),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),n=i._events),c=n[e]),c===void 0)c=n[e]=t,++i._eventsCount;else if(typeof c=="function"?c=n[e]=r?[t,c]:[c,t]:r?c.unshift(t):c.push(t),s=Nn(i),s>0&&c.length>s&&!c.warned){c.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=i,a.type=e,a.count=c.length,Ud(a)}return i}I.prototype.addListener=function(e,t){return Un(this,e,t,!1)};I.prototype.on=I.prototype.addListener;I.prototype.prependListener=function(e,t){return Un(this,e,t,!0)};function $d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zn(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},s=$d.bind(r);return s.listener=t,r.wrapFn=s,s}I.prototype.once=function(e,t){return Tr(t),this.on(e,zn(this,e,t)),this};I.prototype.prependOnceListener=function(e,t){return Tr(t),this.prependListener(e,zn(this,e,t)),this};I.prototype.removeListener=function(e,t){var r,s,n,c,a;if(Tr(t),s=this._events,s===void 0)return this;if(r=s[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(n=-1,c=r.length-1;c>=0;c--)if(r[c]===t||r[c].listener===t){a=r[c].listener,n=c;break}if(n<0)return this;n===0?r.shift():Hd(r,n),r.length===1&&(s[e]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};I.prototype.off=I.prototype.removeListener;I.prototype.removeAllListeners=function(e){var t,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var n=Object.keys(r),c;for(s=0;s<n.length;++s)c=n[s],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function $n(i,e,t){var r=i._events;if(r===void 0)return[];var s=r[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?Kd(s):Vn(s,s.length)}I.prototype.listeners=function(e){return $n(this,e,!0)};I.prototype.rawListeners=function(e){return $n(this,e,!1)};I.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):Hn.call(i,e)};I.prototype.listenerCount=Hn;function Hn(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}I.prototype.eventNames=function(){return this._eventsCount>0?Rr(this._events):[]};function Vn(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function Hd(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function Kd(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function zd(i,e){return new Promise(function(t,r){function s(c){i.removeListener(e,n),r(c)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",s),t([].slice.call(arguments))}Kn(i,e,n,{once:!0}),e!=="error"&&Gd(i,s,{once:!0})})}function Gd(i,e,t){typeof i.on=="function"&&Kn(i,"error",e,t)}function Kn(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function s(n){r.once&&i.removeEventListener(e,s),t(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}});var ze=m(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.EnhancedEventEmitter=void 0;var Jd=Gn(),Wd=A(),Jn=new Wd.Logger("EnhancedEventEmitter"),Wn=class extends Jd.EventEmitter{constructor(){super();this.setMaxListeners(Infinity)}safeEmit(e,...t){let r=this.listenerCount(e);try{return this.emit(e,...t)}catch(s){return Jn.error("safeEmit() | event listener threw an error [event:%s]:%o",e,s),Boolean(r)}}async safeEmitAsPromise(e,...t){return new Promise((r,s)=>{try{this.emit(e,...t,r,s)}catch(n){Jn.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,n),s(n)}})}};Pr.EnhancedEventEmitter=Wn});var ce=m(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.InvalidStateError=gt.UnsupportedError=void 0;var Cr=class extends Error{constructor(e){super(e);this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Cr):this.stack=new Error(e).stack}};gt.UnsupportedError=Cr;var Er=class extends Error{constructor(e){super(e);this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Er):this.stack=new Error(e).stack}};gt.InvalidStateError=Er});var $=m(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.generateRandomNumber=_t.clone=void 0;function Qd(i,e){return typeof i=="undefined"?e:JSON.parse(JSON.stringify(i))}_t.clone=Qd;function Xd(){return Math.round(Math.random()*1e7)}_t.generateRandomNumber=Xd});var la=m(y=>{var Xe=X()("h264-profile-level-id");Xe.log=console.info.bind(console);var Ye=1,Ft=2,Dr=3,Bi=4,qi=5;y.ProfileConstrainedBaseline=Ye;y.ProfileBaseline=Ft;y.ProfileMain=Dr;y.ProfileConstrainedHigh=Bi;y.ProfileHigh=qi;var vt=0,kr=10,Fi=11,Qn=12,Xn=13,Yn=20,Zn=21,ea=22,ta=30,Ni=31,ra=32,ia=40,sa=41,na=42,aa=50,oa=51,ca=52;y.Level1_b=vt;y.Level1=kr;y.Level1_1=Fi;y.Level1_2=Qn;y.Level1_3=Xn;y.Level2=Yn;y.Level2_1=Zn;y.Level2_2=ea;y.Level3=ta;y.Level3_1=Ni;y.Level3_2=ra;y.Level4=ia;y.Level4_1=sa;y.Level4_2=na;y.Level5=aa;y.Level5_1=oa;y.Level5_2=ca;var Nt=class{constructor(e,t){this.profile=e,this.level=t}};y.ProfileLevelId=Nt;var Yd=new Nt(Ye,Ni),Zd=16,Oe=class{constructor(e){this._mask=~da("x",e),this._maskedValue=da("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}},Le=class{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}},ep=[new Le(66,new Oe("x1xx0000"),Ye),new Le(77,new Oe("1xxx0000"),Ye),new Le(88,new Oe("11xx0000"),Ye),new Le(66,new Oe("x0xx0000"),Ft),new Le(88,new Oe("10xx0000"),Ft),new Le(77,new Oe("0x0x0000"),Dr),new Le(100,new Oe("00000000"),qi),new Le(100,new Oe("00001100"),Bi)];y.parseProfileLevelId=function(i){if(typeof i!="string"||i.length!==6)return null;let e=parseInt(i,16);if(e===0)return null;let t=e&255,r=e>>8&255,s=e>>16&255,n;switch(t){case Fi:{n=(r&Zd)!=0?vt:Fi;break}case kr:case Qn:case Xn:case Yn:case Zn:case ea:case ta:case Ni:case ra:case ia:case sa:case na:case aa:case oa:case ca:{n=t;break}default:return Xe("parseProfileLevelId() | unrecognized level_idc:%s",t),null}for(let c of ep)if(s===c.profile_idc&&c.profile_iop.isMatch(r))return new Nt(c.profile,n);return Xe("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null};y.profileLevelIdToString=function(i){if(i.level==vt)switch(i.profile){case Ye:return"42f00b";case Ft:return"42100b";case Dr:return"4d100b";default:return Xe("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",i.profile),null}let e;switch(i.profile){case Ye:{e="42e0";break}case Ft:{e="4200";break}case Dr:{e="4d00";break}case Bi:{e="640c";break}case qi:{e="6400";break}default:return Xe("profileLevelIdToString() | unrecognized profile:%s",i.profile),null}let t=i.level.toString(16);return t.length===1&&(t=`0${t}`),`${e}${t}`};y.parseSdpProfileLevelId=function(i={}){let e=i["profile-level-id"];return e?y.parseProfileLevelId(e):Yd};y.isSameProfile=function(i={},e={}){let t=y.parseSdpProfileLevelId(i),r=y.parseSdpProfileLevelId(e);return Boolean(t&&r&&t.profile===r.profile)};y.generateProfileLevelIdForAnswer=function(i={},e={}){if(!i["profile-level-id"]&&!e["profile-level-id"])return Xe("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;let t=y.parseSdpProfileLevelId(i),r=y.parseSdpProfileLevelId(e);if(!t)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(t.profile!==r.profile)throw new TypeError("H264 Profile mismatch");let s=pa(i)&&pa(e),n=t.level,c=r.level,a=tp(n,c),o=s?n:a;return Xe("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",t.profile,o),y.profileLevelIdToString(new Nt(t.profile,o))};function da(i,e){return(e[0]===i)<<7|(e[1]===i)<<6|(e[2]===i)<<5|(e[3]===i)<<4|(e[4]===i)<<3|(e[5]===i)<<2|(e[6]===i)<<1|(e[7]===i)<<0}function rp(i,e){return i===vt?e!==kr&&e!==vt:e===vt?i!==kr:i<e}function tp(i,e){return rp(i,e)?i:e}function pa(i={}){let e=i["level-asymmetry-allowed"];return e===1||e==="1"}});var re=m(v=>{"use strict";var ip=v&&v.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),sp=v&&v.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),ua=v&&v.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&ip(e,i,t);return sp(e,i),e};Object.defineProperty(v,"__esModule",{value:!0});v.canReceive=v.canSend=v.generateProbatorRtpParameters=v.reduceCodecs=v.getSendingRemoteRtpParameters=v.getSendingRtpParameters=v.getRecvRtpCapabilities=v.getExtendedRtpCapabilities=v.validateSctpStreamParameters=v.validateSctpParameters=v.validateNumSctpStreams=v.validateSctpCapabilities=v.validateRtcpParameters=v.validateRtpEncodingParameters=v.validateRtpHeaderExtensionParameters=v.validateRtpCodecParameters=v.validateRtpParameters=v.validateRtpHeaderExtension=v.validateRtcpFeedback=v.validateRtpCodecCapability=v.validateRtpCapabilities=void 0;var ha=ua(la()),np=ua($()),ap="probator",op=1234,cp=127;function dp(i){if(typeof i!="object")throw new TypeError("caps is not an object");if(i.codecs&&!Array.isArray(i.codecs))throw new TypeError("caps.codecs is not an array");i.codecs||(i.codecs=[]);for(let e of i.codecs)fa(e);if(i.headerExtensions&&!Array.isArray(i.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");i.headerExtensions||(i.headerExtensions=[]);for(let e of i.headerExtensions)ma(e)}v.validateRtpCapabilities=dp;function fa(i){let e=new RegExp("^(audio|video)/(.+)","i");if(typeof i!="object")throw new TypeError("codec is not an object");if(!i.mimeType||typeof i.mimeType!="string")throw new TypeError("missing codec.mimeType");let t=e.exec(i.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(i.kind=t[1].toLowerCase(),i.preferredPayloadType&&typeof i.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof i.clockRate!="number")throw new TypeError("missing codec.clockRate");i.kind==="audio"?typeof i.channels!="number"&&(i.channels=1):delete i.channels,(!i.parameters||typeof i.parameters!="object")&&(i.parameters={});for(let r of Object.keys(i.parameters)){let s=i.parameters[r];if(s===void 0&&(i.parameters[r]="",s=""),typeof s!="string"&&typeof s!="number")throw new TypeError(`invalid codec parameter [key:${r}s, value:${s}]`);if(r==="apt"&&typeof s!="number")throw new TypeError("invalid codec apt parameter")}(!i.rtcpFeedback||!Array.isArray(i.rtcpFeedback))&&(i.rtcpFeedback=[]);for(let r of i.rtcpFeedback)Vi(r)}v.validateRtpCodecCapability=fa;function Vi(i){if(typeof i!="object")throw new TypeError("fb is not an object");if(!i.type||typeof i.type!="string")throw new TypeError("missing fb.type");(!i.parameter||typeof i.parameter!="string")&&(i.parameter="")}v.validateRtcpFeedback=Vi;function ma(i){if(typeof i!="object")throw new TypeError("ext is not an object");if((!i.kind||typeof i.kind!="string")&&(i.kind=""),i.kind!==""&&i.kind!=="audio"&&i.kind!=="video")throw new TypeError("invalid ext.kind");if(!i.uri||typeof i.uri!="string")throw new TypeError("missing ext.uri");if(typeof i.preferredId!="number")throw new TypeError("missing ext.preferredId");if(i.preferredEncrypt&&typeof i.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(i.preferredEncrypt||(i.preferredEncrypt=!1),i.direction&&typeof i.direction!="string")throw new TypeError("invalid ext.direction");i.direction||(i.direction="sendrecv")}v.validateRtpHeaderExtension=ma;function Ui(i){if(typeof i!="object")throw new TypeError("params is not an object");if(i.mid&&typeof i.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(i.codecs))throw new TypeError("missing params.codecs");for(let e of i.codecs)ga(e);if(i.headerExtensions&&!Array.isArray(i.headerExtensions))throw new TypeError("params.headerExtensions is not an array");i.headerExtensions||(i.headerExtensions=[]);for(let e of i.headerExtensions)_a(e);if(i.encodings&&!Array.isArray(i.encodings))throw new TypeError("params.encodings is not an array");i.encodings||(i.encodings=[]);for(let e of i.encodings)va(e);if(i.rtcp&&typeof i.rtcp!="object")throw new TypeError("params.rtcp is not an object");i.rtcp||(i.rtcp={}),ya(i.rtcp)}v.validateRtpParameters=Ui;function ga(i){let e=new RegExp("^(audio|video)/(.+)","i");if(typeof i!="object")throw new TypeError("codec is not an object");if(!i.mimeType||typeof i.mimeType!="string")throw new TypeError("missing codec.mimeType");let t=e.exec(i.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(typeof i.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof i.clockRate!="number")throw new TypeError("missing codec.clockRate");t[1].toLowerCase()==="audio"?typeof i.channels!="number"&&(i.channels=1):delete i.channels,(!i.parameters||typeof i.parameters!="object")&&(i.parameters={});for(let s of Object.keys(i.parameters)){let n=i.parameters[s];if(n===void 0&&(i.parameters[s]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError(`invalid codec parameter [key:${s}s, value:${n}]`);if(s==="apt"&&typeof n!="number")throw new TypeError("invalid codec apt parameter")}(!i.rtcpFeedback||!Array.isArray(i.rtcpFeedback))&&(i.rtcpFeedback=[]);for(let s of i.rtcpFeedback)Vi(s)}v.validateRtpCodecParameters=ga;function _a(i){if(typeof i!="object")throw new TypeError("ext is not an object");if(!i.uri||typeof i.uri!="string")throw new TypeError("missing ext.uri");if(typeof i.id!="number")throw new TypeError("missing ext.id");if(i.encrypt&&typeof i.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");i.encrypt||(i.encrypt=!1),(!i.parameters||typeof i.parameters!="object")&&(i.parameters={});for(let e of Object.keys(i.parameters)){let t=i.parameters[e];if(t===void 0&&(i.parameters[e]="",t=""),typeof t!="string"&&typeof t!="number")throw new TypeError("invalid header extension parameter")}}v.validateRtpHeaderExtensionParameters=_a;function va(i){if(typeof i!="object")throw new TypeError("encoding is not an object");if(i.ssrc&&typeof i.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(i.rid&&typeof i.rid!="string")throw new TypeError("invalid encoding.rid");if(i.rtx&&typeof i.rtx!="object")throw new TypeError("invalid encoding.rtx");if(i.rtx&&typeof i.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!i.dtx||typeof i.dtx!="boolean")&&(i.dtx=!1),i.scalabilityMode&&typeof i.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}v.validateRtpEncodingParameters=va;function ya(i){if(typeof i!="object")throw new TypeError("rtcp is not an object");if(i.cname&&typeof i.cname!="string")throw new TypeError("invalid rtcp.cname");(!i.reducedSize||typeof i.reducedSize!="boolean")&&(i.reducedSize=!0)}v.validateRtcpParameters=ya;function pp(i){if(typeof i!="object")throw new TypeError("caps is not an object");if(!i.numStreams||typeof i.numStreams!="object")throw new TypeError("missing caps.numStreams");Sa(i.numStreams)}v.validateSctpCapabilities=pp;function Sa(i){if(typeof i!="object")throw new TypeError("numStreams is not an object");if(typeof i.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof i.MIS!="number")throw new TypeError("missing numStreams.MIS")}v.validateNumSctpStreams=Sa;function lp(i){if(typeof i!="object")throw new TypeError("params is not an object");if(typeof i.port!="number")throw new TypeError("missing params.port");if(typeof i.OS!="number")throw new TypeError("missing params.OS");if(typeof i.MIS!="number")throw new TypeError("missing params.MIS");if(typeof i.maxMessageSize!="number")throw new TypeError("missing params.maxMessageSize")}v.validateSctpParameters=lp;function up(i){if(typeof i!="object")throw new TypeError("params is not an object");if(typeof i.streamId!="number")throw new TypeError("missing params.streamId");let e=!1;if(typeof i.ordered=="boolean"?e=!0:i.ordered=!0,i.maxPacketLifeTime&&typeof i.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(i.maxRetransmits&&typeof i.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(i.maxPacketLifeTime&&i.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(e&&i.ordered&&(i.maxPacketLifeTime||i.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!e&&(i.maxPacketLifeTime||i.maxRetransmits)&&(i.ordered=!1),i.priority&&typeof i.priority!="string")throw new TypeError("invalid params.priority");if(i.label&&typeof i.label!="string")throw new TypeError("invalid params.label");if(i.protocol&&typeof i.protocol!="string")throw new TypeError("invalid params.protocol")}v.validateSctpStreamParameters=up;function mp(i,e){let t={codecs:[],headerExtensions:[]};for(let r of e.codecs||[]){if(Vt(r))continue;let s=(i.codecs||[]).find(c=>wa(c,r,{strict:!0,modify:!0}));if(!s)continue;let n={mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,channels:s.channels,localPayloadType:s.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:r.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:s.parameters,remoteParameters:r.parameters,rtcpFeedback:fp(s,r)};t.codecs.push(n)}for(let r of t.codecs){let s=i.codecs.find(c=>Vt(c)&&c.parameters.apt===r.localPayloadType),n=e.codecs.find(c=>Vt(c)&&c.parameters.apt===r.remotePayloadType);s&&n&&(r.localRtxPayloadType=s.preferredPayloadType,r.remoteRtxPayloadType=n.preferredPayloadType)}for(let r of e.headerExtensions){let s=i.headerExtensions.find(c=>hp(c,r));if(!s)continue;let n={kind:r.kind,uri:r.uri,sendId:s.preferredId,recvId:r.preferredId,encrypt:s.preferredEncrypt,direction:"sendrecv"};switch(r.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive";break}t.headerExtensions.push(n)}return t}v.getExtendedRtpCapabilities=mp;function gp(i){let e={codecs:[],headerExtensions:[]};for(let t of i.codecs){let r={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(e.codecs.push(r),!t.remoteRtxPayloadType)continue;let s={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};e.codecs.push(s)}for(let t of i.headerExtensions){if(t.direction!=="sendrecv"&&t.direction!=="recvonly")continue;let r={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};e.headerExtensions.push(r)}return e}v.getRecvRtpCapabilities=gp;function _p(i,e){let t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let r of e.codecs){if(r.kind!==i)continue;let s={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(s),r.localRtxPayloadType){let n={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(n)}}for(let r of e.headerExtensions){if(r.kind&&r.kind!==i||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;let s={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};t.headerExtensions.push(s)}return t}v.getSendingRtpParameters=_p;function vp(i,e){let t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let r of e.codecs){if(r.kind!==i)continue;let s={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(s),r.localRtxPayloadType){let n={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(n)}}for(let r of e.headerExtensions){if(r.kind&&r.kind!==i||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;let s={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};t.headerExtensions.push(s)}if(t.headerExtensions.some(r=>r.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(let r of t.codecs)r.rtcpFeedback=(r.rtcpFeedback||[]).filter(s=>s.type!=="goog-remb");else if(t.headerExtensions.some(r=>r.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(let r of t.codecs)r.rtcpFeedback=(r.rtcpFeedback||[]).filter(s=>s.type!=="transport-cc");else for(let r of t.codecs)r.rtcpFeedback=(r.rtcpFeedback||[]).filter(s=>s.type!=="transport-cc"&&s.type!=="goog-remb");return t}v.getSendingRemoteRtpParameters=vp;function yp(i,e){let t=[];if(!e)t.push(i[0]),Vt(i[1])&&t.push(i[1]);else{for(let r=0;r<i.length;++r)if(wa(i[r],e)){t.push(i[r]),Vt(i[r+1])&&t.push(i[r+1]);break}if(t.length===0)throw new TypeError("no matching codec found")}return t}v.reduceCodecs=yp;function Sp(i){i=np.clone(i,{}),Ui(i);let e={mid:ap,codecs:[],headerExtensions:[],encodings:[{ssrc:op}],rtcp:{cname:"probator"}};return e.codecs.push(i.codecs[0]),e.codecs[0].payloadType=cp,e.headerExtensions=i.headerExtensions,e}v.generateProbatorRtpParameters=Sp;function wp(i,e){return e.codecs.some(t=>t.kind===i)}v.canSend=wp;function bp(i,e){if(Ui(i),i.codecs.length===0)return!1;let t=i.codecs[0];return e.codecs.some(r=>r.remotePayloadType===t.payloadType)}v.canReceive=bp;function Vt(i){return i?/.+\/rtx$/i.test(i.mimeType):!1}function wa(i,e,{strict:t=!1,modify:r=!1}={}){let s=i.mimeType.toLowerCase(),n=e.mimeType.toLowerCase();if(s!==n||i.clockRate!==e.clockRate||i.channels!==e.channels)return!1;switch(s){case"video/h264":{let c=i.parameters["packetization-mode"]||0,a=e.parameters["packetization-mode"]||0;if(c!==a)return!1;if(t){if(!ha.isSameProfile(i.parameters,e.parameters))return!1;let o;try{o=ha.generateProfileLevelIdForAnswer(i.parameters,e.parameters)}catch(d){return!1}r&&(o?(i.parameters["profile-level-id"]=o,e.parameters["profile-level-id"]=o):(delete i.parameters["profile-level-id"],delete e.parameters["profile-level-id"]))}break}case"video/vp9":{if(t){let c=i.parameters["profile-id"]||0,a=e.parameters["profile-id"]||0;if(c!==a)return!1}break}}return!0}function hp(i,e){return!(i.kind&&e.kind&&i.kind!==e.kind||i.uri!==e.uri)}function fp(i,e){let t=[];for(let r of i.rtcpFeedback||[]){let s=(e.rtcpFeedback||[]).find(n=>n.type===r.type&&(n.parameter===r.parameter||!n.parameter&&!r.parameter));s&&t.push(s)}return t}});var Ra=m(Ut=>{"use strict";var zi=Ut&&Ut.__awaiter||function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(c){c(n)})}return new(t||(t=Promise))(function(n,c){function a(p){try{d(r.next(p))}catch(l){c(l)}}function o(p){try{d(r.throw(p))}catch(l){c(l)}}function d(p){p.done?n(p.value):s(p.value).then(a,o)}d((r=r.apply(i,e||[])).next())})};Object.defineProperty(Ut,"__esModule",{value:!0});var ba=class{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(let e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return zi(this,void 0,void 0,function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if(typeof e!="function")throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(r){}return new Promise((r,s)=>{let n={task:e,name:t,resolve:r,reject:s,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(n),this.pendingTasks.length===1&&this.next()})})}stop(){if(!this.closed){for(let e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){let e=new Date;return this.pendingTasks.map(t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0}))}next(){return zi(this,void 0,void 0,function*(){let e=this.pendingTasks[0];!e||(yield this.executeTask(e),this.pendingTasks.shift(),this.next())})}executeTask(e){return zi(this,void 0,void 0,function*(){if(!e.stopped){e.executedAt=new Date;try{let t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}})}};Ut.AwaitQueue=ba});var $i=m(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.Producer=void 0;var Rp=A(),Ta=ze(),yt=ce(),he=new Rp.Logger("Producer"),Pa=class extends Ta.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:s,rtpParameters:n,stopTracks:c,disableTrackOnPause:a,zeroRtpOnPause:o,appData:d}){super();this._closed=!1,this._observer=new Ta.EnhancedEventEmitter,he.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=s,this._kind=s.kind,this._rtpParameters=n,this._paused=a?!s.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=c,this._disableTrackOnPause=a,this._zeroRtpOnPause=o,this._appData=d,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(he.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(he.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new yt.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){if(he.debug("pause()"),this._closed){he.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(he.debug("resume()"),this._closed){he.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:e}){if(he.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(t){}throw new yt.InvalidStateError("closed")}else if(e&&e.readyState==="ended")throw new yt.InvalidStateError("track ended");if(e===this._track){he.debug("replaceTrack() | same track, ignored");return}(!this._zeroRtpOnPause||!this._paused)&&await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new yt.InvalidStateError("closed");if(this._kind!=="video")throw new yt.UnsupportedError("not a video Producer");if(typeof e!="number")throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new yt.InvalidStateError("closed");if(typeof e!="object")throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){he.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){!this._track||this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(!!this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}};Ir.Producer=Pa});var Hi=m(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.Consumer=void 0;var Tp=A(),Ca=ze(),Pp=ce(),$e=new Tp.Logger("Consumer"),Ea=class extends Ca.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:s,track:n,rtpParameters:c,appData:a}){super();this._closed=!1,this._observer=new Ca.EnhancedEventEmitter,$e.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=s,this._track=n,this._rtpParameters=c,this._paused=!n.enabled,this._appData=a,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||($e.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||($e.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Pp.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){if($e.debug("pause()"),this._closed){$e.error("pause() | Consumer closed");return}this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause")}resume(){if($e.debug("resume()"),this._closed){$e.error("resume() | Consumer closed");return}this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume")}_onTrackEnded(){$e.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}};Mr.Consumer=Ea});var Ki=m(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.DataProducer=void 0;var Cp=A(),Da=ze(),Ep=ce(),Ae=new Cp.Logger("DataProducer"),ka=class extends Da.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:s}){super();this._closed=!1,this._observer=new Da.EnhancedEventEmitter,Ae.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=s,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(Ae.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ae.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(Ae.debug("send()"),this._closed)throw new Ep.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Ae.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?Ae.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):Ae.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Ae.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||Ae.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};xr.DataProducer=ka});var Gi=m(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.DataConsumer=void 0;var Dp=A(),Ia=ze(),Ze=new Dp.Logger("DataConsumer"),Ma=class extends Ia.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:s,appData:n}){super();this._closed=!1,this._observer=new Ia.EnhancedEventEmitter,Ze.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=s,this._appData=n,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(Ze.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ze.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(Ze.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),t.errorDetail==="sctp-failure"?Ze.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):Ze.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(Ze.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}};Or.DataConsumer=Ma});var Wi=m(fe=>{"use strict";var kp=fe&&fe.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Ip=fe&&fe.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),xa=fe&&fe.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&kp(e,i,t);return Ip(e,i),e};Object.defineProperty(fe,"__esModule",{value:!0});fe.Transport=void 0;var Mp=Ra(),xp=A(),Oa=ze(),j=ce(),Ji=xa($()),zt=xa(re()),Op=$i(),Lp=Hi(),Ap=Ki(),jp=Gi(),ie=new xp.Logger("Transport"),La=class extends Oa.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:s,dtlsParameters:n,sctpParameters:c,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l,handlerFactory:u,extendedRtpCapabilities:h,canProduceByKind:f}){super();this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new Mp.AwaitQueue({ClosedErrorClass:j.InvalidStateError}),this._observer=new Oa.EnhancedEventEmitter,ie.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=h,this._canProduceByKind=f,this._maxSctpMessageSize=c?c.maxMessageSize:null,d=Ji.clone(d,{}),delete d.iceServers,delete d.iceTransportPolicy,delete d.bundlePolicy,delete d.rtcpMuxPolicy,delete d.sdpSemantics,this._handler=u(),this._handler.run({direction:e,iceParameters:r,iceCandidates:s,dtlsParameters:n,sctpParameters:c,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,extendedRtpCapabilities:h}),this._appData=l,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){ie.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(let e of this._producers.values())e.transportClosed();this._producers.clear();for(let e of this._consumers.values())e.transportClosed();this._consumers.clear();for(let e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(let e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new j.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(ie.debug("restartIce()"),this._closed)throw new j.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(ie.debug("updateIceServers()"),this._closed)throw new j.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:s,stopTracks:n=!0,disableTrackOnPause:c=!0,zeroRtpOnPause:a=!1,appData:o={}}={}){if(ie.debug("produce() [track:%o]",e),e){if(this._direction!=="send")throw new j.UnsupportedError("not a sending Transport");if(this._canProduceByKind[e.kind]){if(e.readyState==="ended")throw new j.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object")}else throw new j.UnsupportedError(`cannot produce ${e.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let d;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&t.length===0?d=void 0:t&&(d=t.map(h=>{let f={active:!0};return h.active===!1&&(f.active=!1),typeof h.dtx=="boolean"&&(f.dtx=h.dtx),typeof h.scalabilityMode=="string"&&(f.scalabilityMode=h.scalabilityMode),typeof h.scaleResolutionDownBy=="number"&&(f.scaleResolutionDownBy=h.scaleResolutionDownBy),typeof h.maxBitrate=="number"&&(f.maxBitrate=h.maxBitrate),typeof h.maxFramerate=="number"&&(f.maxFramerate=h.maxFramerate),typeof h.adaptivePtime=="boolean"&&(f.adaptivePtime=h.adaptivePtime),typeof h.priority=="string"&&(f.priority=h.priority),typeof h.networkPriority=="string"&&(f.networkPriority=h.networkPriority),f}));let{localId:p,rtpParameters:l,rtpSender:u}=await this._handler.send({track:e,encodings:d,codecOptions:r,codec:s});try{zt.validateRtpParameters(l);let{id:h}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:l,appData:o}),f=new Op.Producer({id:h,localId:p,rtpSender:u,track:e,rtpParameters:l,stopTracks:n,disableTrackOnPause:c,zeroRtpOnPause:a,appData:o});return this._producers.set(f.id,f),this._handleProducer(f),this._observer.safeEmit("newproducer",f),f}catch(h){throw this._handler.stopSending(p).catch(()=>{}),h}},"transport.produce()").catch(d=>{if(n)try{e.stop()}catch(p){}throw d})}async consume({id:e,producerId:t,kind:r,rtpParameters:s,appData:n={}}){if(ie.debug("consume()"),s=Ji.clone(s,void 0),this._closed)throw new j.InvalidStateError("closed");if(this._direction!=="recv")throw new j.UnsupportedError("not a receiving Transport");if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing producerId");if(r!=="audio"&&r!=="video")throw new TypeError(`invalid kind '${r}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(n&&typeof n!="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{if(!zt.canReceive(s,this._extendedRtpCapabilities))throw new j.UnsupportedError("cannot consume this Producer");let{localId:a,rtpReceiver:o,track:d}=await this._handler.receive({trackId:e,kind:r,rtpParameters:s}),p=new Lp.Consumer({id:e,localId:a,producerId:t,rtpReceiver:o,track:d,rtpParameters:s,appData:n});if(this._consumers.set(p.id,p),this._handleConsumer(p),!this._probatorConsumerCreated&&r==="video")try{let l=zt.generateProbatorRtpParameters(p.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:l}),ie.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(l){ie.error("consume() | failed to create Consumer for RTP probation:%o",l)}return this._observer.safeEmit("newconsumer",p),p},"transport.consume()")}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,priority:s="low",label:n="",protocol:c="",appData:a={}}={}){if(ie.debug("produceData()"),this._direction!=="send")throw new j.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize)if(["very-low","low","medium","high"].includes(s)){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("wrong priority");else throw new j.UnsupportedError("SCTP not enabled by remote Transport");return(t||r)&&(e=!1),this._awaitQueue.push(async()=>{let{dataChannel:o,sctpStreamParameters:d}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,priority:s,label:n,protocol:c});zt.validateSctpStreamParameters(d);let{id:p}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:d,label:n,protocol:c,appData:a}),l=new Ap.DataProducer({id:p,dataChannel:o,sctpStreamParameters:d,appData:a});return this._dataProducers.set(l.id,l),this._handleDataProducer(l),this._observer.safeEmit("newdataproducer",l),l},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:s="",protocol:n="",appData:c={}}){if(ie.debug("consumeData()"),r=Ji.clone(r,void 0),this._closed)throw new j.InvalidStateError("closed");if(this._direction!=="recv")throw new j.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object")}else throw new j.UnsupportedError("SCTP not enabled by remote Transport");return zt.validateSctpStreamParameters(r),this._awaitQueue.push(async()=>{let{dataChannel:a}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:s,protocol:n}),o=new jp.DataConsumer({id:e,dataProducerId:t,dataChannel:a,sctpStreamParameters:r,appData:c});return this._dataConsumers.set(o.id,o),this._handleDataConsumer(o),this._observer.safeEmit("newdataconsumer",o),o},"transport.consumeData()")}_handleHandler(){let e=this._handler;e.on("@connect",({dtlsParameters:t},r,s)=>{if(this._closed){s(new j.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:t},r,s)}),e.on("@connectionstatechange",t=>{t!==this._connectionState&&(ie.debug("connection state changed to %s",t),this._connectionState=t,this._closed||this.safeEmit("connectionstatechange",t))})}_handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push(async()=>this._handler.stopSending(e.localId),"producer @close event").catch(t=>ie.warn("producer.close() failed:%o",t))}),e.on("@replacetrack",(t,r,s)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(r).catch(s)}),e.on("@setmaxspatiallayer",(t,r,s)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(r).catch(s)}),e.on("@setrtpencodingparameters",(t,r,s)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(r).catch(s)}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new j.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)})}_handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),!this._closed&&this._awaitQueue.push(async()=>this._handler.stopReceiving(e.localId),"consumer @close event").catch(()=>{})}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new j.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)})}_handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}_handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}};fe.Transport=La});var Qi=m((Kh,Aa)=>{var ja=Aa.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(i){return i.encoding?"rtpmap:%d %s/%s/%s":i.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(i){return i.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(i){return i.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(i){return"extmap:%d"+(i.direction?"/%s":"%v")+(i["encrypt-uri"]?" %s":"%v")+" %s"+(i.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(i){return i.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(i){var e="candidate:%s %d %s %d %s %d typ %s";return e+=i.raddr!=null?" raddr %s rport %d":"%v%v",e+=i.tcptype!=null?" tcptype %s":"%v",i.generation!=null&&(e+=" generation %d"),e+=i["network-id"]!=null?" network-id %d":"%v",e+=i["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(i){var e="ssrc:%d";return i.attribute!=null&&(e+=" %s",i.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(i){return i.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(i){return i.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(i){return"imageattr:%s %s %s"+(i.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(i){return"simulcast:%s %s"+(i.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(i){return"ts-refclk:%s"+(i.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(i){var e="mediaclk:";return e+=i.id!=null?"id=%s %s":"%v%s",e+=i.mediaClockValue!=null?"=%s":"",e+=i.rateNumerator!=null?" rate=%s":"",e+=i.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(ja).forEach(function(i){var e=ja[i];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})})});var Fa=m(je=>{var St=function(i){return String(Number(i))===i?Number(i):i},Bp=function(i,e,t,r){if(r&&!t)e[r]=St(i[1]);else for(var s=0;s<t.length;s+=1)i[s+1]!=null&&(e[t[s]]=St(i[s+1]))},qp=function(i,e,t){var r=i.name&&i.names;i.push&&!e[i.push]?e[i.push]=[]:r&&!e[i.name]&&(e[i.name]={});var s=i.push?{}:r?e[i.name]:e;Bp(t.match(i.reg),s,i.names,i.name),i.push&&e[i.push].push(s)},Ba=Qi(),Fp=RegExp.prototype.test.bind(/^([a-z])=(.*)/);je.parse=function(i){var e={},t=[],r=e;return i.split(/(\r\n|\r|\n)/).filter(Fp).forEach(function(s){var n=s[0],c=s.slice(2);n==="m"&&(t.push({rtp:[],fmtp:[]}),r=t[t.length-1]);for(var a=0;a<(Ba[n]||[]).length;a+=1){var o=Ba[n][a];if(o.reg.test(c))return qp(o,r,c)}}),e.media=t,e};var qa=function(i,e){var t=e.split(/=(.+)/,2);return t.length===2?i[t[0]]=St(t[1]):t.length===1&&e.length>1&&(i[t[0]]=void 0),i};je.parseParams=function(i){return i.split(/;\s?/).reduce(qa,{})};je.parseFmtpConfig=je.parseParams;je.parsePayloads=function(i){return i.toString().split(" ").map(Number)};je.parseRemoteCandidates=function(i){for(var e=[],t=i.split(" ").map(St),r=0;r<t.length;r+=3)e.push({component:t[r],ip:t[r+1],port:t[r+2]});return e};je.parseImageAttributes=function(i){return i.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(qa,{})})};je.parseSimulcastStreamList=function(i){return i.split(";").map(function(e){return e.split(",").map(function(t){var r,s=!1;return t[0]!=="~"?r=St(t):(r=St(t.substring(1,t.length)),s=!0),{scid:r,paused:s}})})}});var Va=m((Jh,Na)=>{var Xi=Qi(),Np=/%[sdv%]/g,Vp=function(i){var e=1,t=arguments,r=t.length;return i.replace(Np,function(s){if(e>=r)return s;var n=t[e];switch(e+=1,s){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},$t=function(i,e,t){var r=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,s=[i+"="+r];if(e.names)for(var n=0;n<e.names.length;n+=1){var c=e.names[n];e.name?s.push(t[e.name][c]):s.push(t[e.names[n]])}else s.push(t[e.name]);return Vp.apply(null,s)},Up=["v","o","s","i","u","e","p","c","b","t","r","z","a"],zp=["i","c","b","a"];Na.exports=function(i,e){e=e||{},i.version==null&&(i.version=0),i.name==null&&(i.name=" "),i.media.forEach(function(n){n.payloads==null&&(n.payloads="")});var t=e.outerOrder||Up,r=e.innerOrder||zp,s=[];return t.forEach(function(n){Xi[n].forEach(function(c){c.name in i&&i[c.name]!=null?s.push($t(n,c,i)):c.push in i&&i[c.push]!=null&&i[c.push].forEach(function(a){s.push($t(n,c,a))})})}),i.media.forEach(function(n){s.push($t("m",Xi.m[0],n)),r.forEach(function(c){Xi[c].forEach(function(a){a.name in n&&n[a.name]!=null?s.push($t(c,a,n)):a.push in n&&n[a.push]!=null&&n[a.push].forEach(function(o){s.push($t(c,a,o))})})})}),s.join(`\r
`)+`\r
`}});var de=m(Be=>{var et=Fa(),$p=Va();Be.write=$p;Be.parse=et.parse;Be.parseParams=et.parseParams;Be.parseFmtpConfig=et.parseFmtpConfig;Be.parsePayloads=et.parsePayloads;Be.parseRemoteCandidates=et.parseRemoteCandidates;Be.parseImageAttributes=et.parseImageAttributes;Be.parseSimulcastStreamList=et.parseSimulcastStreamList});var qe=m(F=>{"use strict";var Hp=F&&F.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Kp=F&&F.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Gp=F&&F.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Hp(e,i,t);return Kp(e,i),e};Object.defineProperty(F,"__esModule",{value:!0});F.applyCodecParameters=F.getCname=F.extractDtlsParameters=F.extractRtpCapabilities=void 0;var Ua=Gp(de());function Jp({sdpObject:i}){let e=new Map,t=[],r=!1,s=!1;for(let c of i.media){let a=c.type;switch(a){case"audio":{if(r)continue;r=!0;break}case"video":{if(s)continue;s=!0;break}default:continue}for(let o of c.rtp){let d={kind:a,mimeType:`${a}/${o.codec}`,preferredPayloadType:o.payload,clockRate:o.rate,channels:o.encoding,parameters:{},rtcpFeedback:[]};e.set(d.preferredPayloadType,d)}for(let o of c.fmtp||[]){let d=Ua.parseParams(o.config),p=e.get(o.payload);!p||(d&&d["profile-level-id"]&&(d["profile-level-id"]=String(d["profile-level-id"])),p.parameters=d)}for(let o of c.rtcpFb||[]){let d=e.get(o.payload);if(!d)continue;let p={type:o.type,parameter:o.subtype};p.parameter||delete p.parameter,d.rtcpFeedback.push(p)}for(let o of c.ext||[]){if(o["encrypt-uri"])continue;let d={kind:a,uri:o.uri,preferredId:o.value};t.push(d)}}return{codecs:Array.from(e.values()),headerExtensions:t}}F.extractRtpCapabilities=Jp;function Wp({sdpObject:i}){let e=(i.media||[]).find(n=>n.iceUfrag&&n.port!==0);if(!e)throw new Error("no active media section found");let t=e.fingerprint||i.fingerprint,r;switch(e.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto";break}return{role:r,fingerprints:[{algorithm:t.type,value:t.hash}]}}F.extractDtlsParameters=Wp;function Qp({offerMediaObject:i}){let e=(i.ssrcs||[]).find(t=>t.attribute==="cname");return e?e.value:""}F.getCname=Qp;function Xp({offerRtpParameters:i,answerMediaObject:e}){for(let t of i.codecs){let r=t.mimeType.toLowerCase();if(r!=="audio/opus"||!(e.rtp||[]).find(a=>a.payload===t.payloadType))continue;e.fmtp=e.fmtp||[];let n=e.fmtp.find(a=>a.payload===t.payloadType);n||(n={payload:t.payloadType,config:""},e.fmtp.push(n));let c=Ua.parseParams(n.config);switch(r){case"audio/opus":{let a=t.parameters["sprop-stereo"];a!==void 0&&(c.stereo=a?1:0);break}}n.config="";for(let a of Object.keys(c))n.config&&(n.config+=";"),n.config+=`${a}=${c[a]}`}}F.applyCodecParameters=Xp});var Ht=m(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.addLegacySimulcast=wt.getRtpEncodings=void 0;function Yp({offerMediaObject:i}){let e=new Set;for(let s of i.ssrcs||[]){let n=s.id;e.add(n)}if(e.size===0)throw new Error("no a=ssrc lines found");let t=new Map;for(let s of i.ssrcGroups||[]){if(s.semantics!=="FID")continue;let[n,c]=s.ssrcs.split(/\s+/);n=Number(n),c=Number(c),e.has(n)&&(e.delete(n),e.delete(c),t.set(n,c))}for(let s of e)t.set(s,null);let r=[];for(let[s,n]of t){let c={ssrc:s};n&&(c.rtx={ssrc:n}),r.push(c)}return r}wt.getRtpEncodings=Yp;function Zp({offerMediaObject:i,numStreams:e}){if(e<=1)throw new TypeError("numStreams must be greater than 1");let t=(i.ssrcs||[]).find(l=>l.attribute==="msid");if(!t)throw new Error("a=ssrc line with msid information not found");let[r,s]=t.value.split(" ")[0],n=t.id,c;(i.ssrcGroups||[]).some(l=>{if(l.semantics!=="FID")return!1;let u=l.ssrcs.split(/\s+/);return Number(u[0])===n?(c=Number(u[1]),!0):!1});let a=i.ssrcs.find(l=>l.attribute==="cname");if(!a)throw new Error("a=ssrc line with cname information not found");let o=a.value,d=[],p=[];for(let l=0;l<e;++l)d.push(n+l),c&&p.push(c+l);i.ssrcGroups=[],i.ssrcs=[],i.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let l=0;l<d.length;++l){let u=d[l];i.ssrcs.push({id:u,attribute:"cname",value:o}),i.ssrcs.push({id:u,attribute:"msid",value:`${r} ${s}`})}for(let l=0;l<p.length;++l){let u=d[l],h=p[l];i.ssrcs.push({id:h,attribute:"cname",value:o}),i.ssrcs.push({id:h,attribute:"msid",value:`${r} ${s}`}),i.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${h}`})}}wt.addLegacySimulcast=Zp});var pe=m(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.HandlerInterface=void 0;var el=ze(),za=class extends el.EnhancedEventEmitter{constructor(){super()}};Lr.HandlerInterface=za});var Ga=m(J=>{"use strict";var tl=J&&J.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),rl=J&&J.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),il=J&&J.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&tl(e,i,t);return rl(e,i),e};Object.defineProperty(J,"__esModule",{value:!0});J.OfferMediaSection=J.AnswerMediaSection=J.MediaSection=void 0;var sl=il($()),Ar=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:s=!1}){if(this._mediaObject={},this._planB=s,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(let n of t){let c={};c.component=1,c.foundation=n.foundation,c.ip=n.ip,c.port=n.port,c.priority=n.priority,c.transport=n.protocol,c.type=n.type,n.tcpType&&(c.tcptype=n.tcpType),this._mediaObject.candidates.push(c)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}};J.MediaSection=Ar;var $a=class extends Ar{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:s,plainRtpParameters:n,planB:c=!1,offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:d,codecOptions:p,extmapAllowMixed:l=!1}){super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:c});switch(this._mediaObject.mid=String(a.mid),this._mediaObject.type=a.type,this._mediaObject.protocol=a.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),a.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(let u of d.codecs){let h={payload:u.payloadType,codec:Ha(u),rate:u.clockRate};u.channels>1&&(h.encoding=u.channels),this._mediaObject.rtp.push(h);let f=sl.clone(u.parameters,{});if(p){let{opusStereo:g,opusFec:M,opusDtx:L,opusMaxPlaybackRate:z,opusMaxAverageBitrate:xe,opusPtime:Ne,videoGoogleStartBitrate:Ve,videoGoogleMaxBitrate:rt,videoGoogleMinBitrate:Ot}=p,K=o.codecs.find(it=>it.payloadType===u.payloadType);switch(u.mimeType.toLowerCase()){case"audio/opus":{g!==void 0&&(K.parameters["sprop-stereo"]=g?1:0,f.stereo=g?1:0),M!==void 0&&(K.parameters.useinbandfec=M?1:0,f.useinbandfec=M?1:0),L!==void 0&&(K.parameters.usedtx=L?1:0,f.usedtx=L?1:0),z!==void 0&&(f.maxplaybackrate=z),xe!==void 0&&(f.maxaveragebitrate=xe),Ne!==void 0&&(K.parameters.ptime=Ne,f.ptime=Ne);break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{Ve!==void 0&&(f["x-google-start-bitrate"]=Ve),rt!==void 0&&(f["x-google-max-bitrate"]=rt),Ot!==void 0&&(f["x-google-min-bitrate"]=Ot);break}}}let _={payload:u.payloadType,config:""};for(let g of Object.keys(f))_.config&&(_.config+=";"),_.config+=`${g}=${f[g]}`;_.config&&this._mediaObject.fmtp.push(_);for(let g of u.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:u.payloadType,type:g.type,subtype:g.parameter})}this._mediaObject.payloads=d.codecs.map(u=>u.payloadType).join(" "),this._mediaObject.ext=[];for(let u of d.headerExtensions)!(a.ext||[]).some(f=>f.uri===u.uri)||this._mediaObject.ext.push({uri:u.uri,value:u.id});if(l&&a.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1},this._mediaObject.rids=[];for(let u of a.rids||[])u.direction==="send"&&this._mediaObject.rids.push({id:u.id,direction:"recv"})}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(let u of a.rids||[])u.direction==="send"&&this._mediaObject.rids.push({id:u.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof a.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize):a.sctpmap&&(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize});break}}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass";break}}};J.AnswerMediaSection=$a;var Ka=class extends Ar{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:s,plainRtpParameters:n,planB:c=!1,mid:a,kind:o,offerRtpParameters:d,streamId:p,trackId:l,oldDataChannelSpec:u=!1}){super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:c});switch(this._mediaObject.mid=String(a),this._mediaObject.type=o,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},s?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${p||"-"} ${l}`);for(let g of d.codecs){let M={payload:g.payloadType,codec:Ha(g),rate:g.clockRate};g.channels>1&&(M.encoding=g.channels),this._mediaObject.rtp.push(M);let L={payload:g.payloadType,config:""};for(let z of Object.keys(g.parameters))L.config&&(L.config+=";"),L.config+=`${z}=${g.parameters[z]}`;L.config&&this._mediaObject.fmtp.push(L);for(let z of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:z.type,subtype:z.parameter})}this._mediaObject.payloads=d.codecs.map(g=>g.payloadType).join(" "),this._mediaObject.ext=[];for(let g of d.headerExtensions)this._mediaObject.ext.push({uri:g.uri,value:g.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";let h=d.encodings[0],f=h.ssrc,_=h.rtx&&h.rtx.ssrc?h.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],d.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${p||"-"} ${l}`}),_&&(d.rtcp.cname&&this._mediaObject.ssrcs.push({id:_,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:_,attribute:"msid",value:`${p||"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${f} ${_}`}));break}case"application":{u?(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize);break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){let s=e.encodings[0],n=s.ssrc,c=s.rtx&&s.rtx.ssrc?s.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),c&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:c,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${c}`}))}planBStopReceiving({offerRtpParameters:e}){let t=e.encodings[0],r=t.ssrc,s=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(n=>n.id!==r&&n.id!==s),s&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(n=>n.ssrcs!==`${r} ${s}`))}};J.OfferMediaSection=Ka;function Ha(i){let t=new RegExp("^(audio|video)/(.+)","i").exec(i.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}});var Fe=m(me=>{"use strict";var nl=me&&me.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),al=me&&me.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),ol=me&&me.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&nl(e,i,t);return al(e,i),e};Object.defineProperty(me,"__esModule",{value:!0});me.RemoteSdp=void 0;var cl=ol(de()),dl=A(),jr=Ga(),Yi=new dl.Logger("RemoteSdp"),Ja=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:s,plainRtpParameters:n,planB:c=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=s,this._plainRtpParameters=n,this._planB=c,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};let a=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[a-1].algorithm,hash:r.fingerprints[a-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){Yi.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(let t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){Yi.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(let t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){let t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:s,codecOptions:n,extmapAllowMixed:c=!1}){let a=new jr.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:s,codecOptions:n,extmapAllowMixed:c});t?this._replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:s,trackId:n}){let c=this._midToIndex.get(e),a;if(c!==void 0&&(a=this._mediaSections[c]),a)a.planBReceive({offerRtpParameters:r,streamId:s,trackId:n}),this._replaceMediaSection(a);else{a=new jr.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:s,trackId:n});let o=this._mediaSections.find(d=>d.closed);o?this._replaceMediaSection(a,o.mid):this._addMediaSection(a)}}disableMediaSection(e){let t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);this._mediaSections[t].disable()}closeMediaSection(e){let t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);let r=this._mediaSections[t];if(e===this._firstMid){Yi.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e);return}r.close(),this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){let r=this._midToIndex.get(e);if(r===void 0)throw new Error(`no media section found with mid '${e}'`);let s=this._mediaSections[r];s.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(s)}sendSctpAssociation({offerMediaObject:e}){let t=new jr.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){let t=new jr.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,cl.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if(typeof t=="string"){let r=this._midToIndex.get(t);if(r===void 0)throw new Error(`no media section found for reuseMid '${t}'`);let s=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(s.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{let r=this._midToIndex.get(e.mid);if(r===void 0)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[r]=e,this._sdpObject.media[r]=e.getObject()}}_regenerateBundleMids(){!this._dtlsParameters||(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}};me.RemoteSdp=Ja});var qr=m(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.parse=void 0;var pl=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function ll(i){let e=pl.exec(i||"");return e?{spatialLayers:Number(e[1]),temporalLayers:Number(e[2])}:{spatialLayers:1,temporalLayers:1}}Br.parse=ll});var Xa=m(ge=>{"use strict";var ul=ge&&ge.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),hl=ge&&ge.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Kt=ge&&ge.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&ul(e,i,t);return hl(e,i),e};Object.defineProperty(ge,"__esModule",{value:!0});ge.Chrome74=void 0;var _e=Kt(de()),fl=A(),Wa=Kt($()),bt=Kt(re()),Fr=Kt(qe()),Zi=Kt(Ht()),ml=pe(),gl=Fe(),_l=qr(),R=new fl.Logger("Chrome74"),Qa={OS:1024,MIS:1024},Nr=class extends ml.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Nr}get name(){return"Chrome74"}close(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){R.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(n){}let r=_e.parse(t.sdp);return Fr.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return R.debug("getNativeSctpCapabilities()"),{numStreams:Qa}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){R.debug("run()"),this._direction=e,this._remoteSdp=new gl.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n}),this._sendingRtpParametersByKind={audio:bt.getSendingRtpParameters("audio",p),video:bt.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:bt.getSendingRemoteRtpParameters("audio",p),video:bt.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){R.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((g,M)=>{g.rid=`r${M}`});let n=Wa.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=bt.reduceCodecs(n.codecs,s);let c=Wa.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});c.codecs=bt.reduceCodecs(c.codecs,s);let a=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),d=await this._pc.createOffer(),p=_e.parse(d.sdp),l;this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:p});let u=!1,h=_l.parse((t||[{}])[0].scalabilityMode);t&&t.length===1&&h.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(R.debug("send() | enabling legacy simulcast for VP9 SVC"),u=!0,p=_e.parse(d.sdp),l=p.media[a.idx],Zi.addLegacySimulcast({offerMediaObject:l,numStreams:h.spatialLayers}),d={type:"offer",sdp:_e.write(p)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);let f=o.mid;if(n.mid=f,p=_e.parse(this._pc.localDescription.sdp),l=p.media[a.idx],n.rtcp.cname=Fr.getCname({offerMediaObject:l}),!t)n.encodings=Zi.getRtpEncodings({offerMediaObject:l});else if(t.length===1){let g=Zi.getRtpEncodings({offerMediaObject:l});Object.assign(g[0],t[0]),u&&(g=[g[0]]),n.encodings=g}else n.encodings=t;if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let g of n.encodings)g.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:c,codecOptions:r,extmapAllowMixed:!0});let _={type:"answer",sdp:this._remoteSdp.getSdp()};return R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,o),{localId:f,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection(),R.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);let r=await this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let s={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?R.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):R.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),R.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{c<=t?n.active=!0:n.active=!1}),await r.sender.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),R.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.sender.setParameters(s)}async getSenderStats(e){this._assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n,priority:c};R.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Qa.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=_e.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),R.debug("receive() [trackId:%s, kind:%s]",e,t);let s=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});let n={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let c=await this._pc.createAnswer(),a=_e.parse(c.sdp),o=a.media.find(p=>String(p.mid)===s);Fr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:o}),c={type:"answer",sdp:_e.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:a}),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);let d=this._pc.getTransceivers().find(p=>p.mid===s);if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,d),{localId:s,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),R.debug("stopReceiving() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);let r={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let s=await this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this._assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a,protocol:r};R.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let p={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=_e.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=_e.parse(this._pc.localDescription.sdp));let r=Fr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};ge.Chrome74=Nr});var eo=m(ve=>{"use strict";var vl=ve&&ve.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),yl=ve&&ve.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Gt=ve&&ve.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&vl(e,i,t);return yl(e,i),e};Object.defineProperty(ve,"__esModule",{value:!0});ve.Chrome70=void 0;var se=Gt(de()),Sl=A(),Ya=Gt($()),Rt=Gt(re()),Vr=Gt(qe()),es=Gt(Ht()),wl=pe(),bl=Fe(),Rl=qr(),S=new Sl.Logger("Chrome70"),Za={OS:1024,MIS:1024},Ur=class extends wl.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Ur}get name(){return"Chrome70"}close(){if(S.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){S.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(n){}let r=se.parse(t.sdp);return Vr.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return S.debug("getNativeSctpCapabilities()"),{numStreams:Za}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){S.debug("run()"),this._direction=e,this._remoteSdp=new bl.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Rt.getSendingRtpParameters("audio",p),video:Rt.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:Rt.getSendingRemoteRtpParameters("audio",p),video:Rt.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){S.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(S.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),S.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let n=Ya.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=Rt.reduceCodecs(n.codecs,s);let c=Ya.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});c.codecs=Rt.reduceCodecs(c.codecs,s);let a=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]}),d=await this._pc.createOffer(),p=se.parse(d.sdp),l;this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:p}),t&&t.length>1&&(S.debug("send() | enabling legacy simulcast"),p=se.parse(d.sdp),l=p.media[a.idx],es.addLegacySimulcast({offerMediaObject:l,numStreams:t.length}),d={type:"offer",sdp:se.write(p)});let u=!1,h=Rl.parse((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&h.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(S.debug("send() | enabling legacy simulcast for VP9 SVC"),u=!0,p=se.parse(d.sdp),l=p.media[a.idx],es.addLegacySimulcast({offerMediaObject:l,numStreams:h.spatialLayers}),d={type:"offer",sdp:se.write(p)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d),t){S.debug("send() | applying given encodings");let g=o.sender.getParameters();for(let M=0;M<(g.encodings||[]).length;++M){let L=g.encodings[M],z=t[M];if(!z)break;g.encodings[M]=Object.assign(L,z)}await o.sender.setParameters(g)}let f=o.mid;if(n.mid=f,p=se.parse(this._pc.localDescription.sdp),l=p.media[a.idx],n.rtcp.cname=Vr.getCname({offerMediaObject:l}),n.encodings=es.getRtpEncodings({offerMediaObject:l}),t)for(let g=0;g<n.encodings.length;++g)t[g]&&Object.assign(n.encodings[g],t[g]);if(u&&(n.encodings=[n.encodings[0]]),n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let g of n.encodings)g.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:c,codecOptions:r});let _={type:"answer",sdp:this._remoteSdp.getSdp()};return S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,o),{localId:f,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection(),S.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);let r=await this._pc.createOffer();S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let s={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?S.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):S.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{c<=t?n.active=!0:n.active=!1}),await r.sender.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.sender.setParameters(s)}async getSenderStats(e){this._assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n,priority:c};S.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Za.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=se.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),S.debug("receive() [trackId:%s, kind:%s]",e,t);let s=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});let n={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let c=await this._pc.createAnswer(),a=se.parse(c.sdp),o=a.media.find(p=>String(p.mid)===s);Vr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:o}),c={type:"answer",sdp:se.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:a}),S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);let d=this._pc.getTransceivers().find(p=>p.mid===s);if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,d),{localId:s,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),S.debug("stopReceiving() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);let r={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let s=await this._pc.createAnswer();S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this._assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmitTime:c,maxRetransmits:a,protocol:r};S.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let p={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=se.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=se.parse(this._pc.localDescription.sdp));let r=Vr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};ve.Chrome70=Ur});var Jt=m(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.addLegacySimulcast=Tt.getRtpEncodings=void 0;function Tl({offerMediaObject:i,track:e}){let t,r=new Set;for(let c of i.ssrcs||[]){if(c.attribute!=="msid")continue;if(c.value.split(" ")[1]===e.id){let o=c.id;r.add(o),t||(t=o)}}if(r.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${e.id}]`);let s=new Map;for(let c of i.ssrcGroups||[]){if(c.semantics!=="FID")continue;let[a,o]=c.ssrcs.split(/\s+/);a=Number(a),o=Number(o),r.has(a)&&(r.delete(a),r.delete(o),s.set(a,o))}for(let c of r)s.set(c,null);let n=[];for(let[c,a]of s){let o={ssrc:c};a&&(o.rtx={ssrc:a}),n.push(o)}return n}Tt.getRtpEncodings=Tl;function Pl({offerMediaObject:i,track:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");let r,s,n;if(!(i.ssrcs||[]).find(l=>l.attribute!=="msid"?!1:l.value.split(" ")[1]===e.id?(r=l.id,n=l.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${e.id}]`);(i.ssrcGroups||[]).some(l=>{if(l.semantics!=="FID")return!1;let u=l.ssrcs.split(/\s+/);return Number(u[0])===r?(s=Number(u[1]),!0):!1});let a=i.ssrcs.find(l=>l.attribute==="cname"&&l.id===r);if(!a)throw new Error(`a=ssrc line with cname information not found [track.id:${e.id}]`);let o=a.value,d=[],p=[];for(let l=0;l<t;++l)d.push(r+l),s&&p.push(s+l);i.ssrcGroups=i.ssrcGroups||[],i.ssrcs=i.ssrcs||[],i.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let l=0;l<d.length;++l){let u=d[l];i.ssrcs.push({id:u,attribute:"cname",value:o}),i.ssrcs.push({id:u,attribute:"msid",value:`${n} ${e.id}`})}for(let l=0;l<p.length;++l){let u=d[l],h=p[l];i.ssrcs.push({id:h,attribute:"cname",value:o}),i.ssrcs.push({id:h,attribute:"msid",value:`${n} ${e.id}`}),i.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${h}`})}}Tt.addLegacySimulcast=Pl});var so=m(ye=>{"use strict";var Cl=ye&&ye.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),El=ye&&ye.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Wt=ye&&ye.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Cl(e,i,t);return El(e,i),e};Object.defineProperty(ye,"__esModule",{value:!0});ye.Chrome67=void 0;var Se=Wt(de()),Dl=A(),to=Wt($()),Pt=Wt(re()),zr=Wt(qe()),ro=Wt(Jt()),kl=pe(),Il=Fe(),w=new Dl.Logger("Chrome67"),io={OS:1024,MIS:1024},$r=class extends kl.HandlerInterface{constructor(){super();this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new $r}get name(){return"Chrome67"}close(){if(w.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){w.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(n){}let r=Se.parse(t.sdp);return zr.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return w.debug("getNativeSctpCapabilities()"),{numStreams:io}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){w.debug("run()"),this._direction=e,this._remoteSdp=new Il.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:Pt.getSendingRtpParameters("audio",p),video:Pt.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:Pt.getSendingRemoteRtpParameters("audio",p),video:Pt.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){w.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(w.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),w.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),s&&w.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let n=await this._pc.createOffer(),c=Se.parse(n.sdp),a,o=to.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=Pt.reduceCodecs(o.codecs);let d=to.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=Pt.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:c}),e.kind==="video"&&t&&t.length>1&&(w.debug("send() | enabling simulcast"),c=Se.parse(n.sdp),a=c.media.find(h=>h.type==="video"),ro.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),n={type:"offer",sdp:Se.write(c)}),w.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),c=Se.parse(this._pc.localDescription.sdp),a=c.media.find(h=>h.type===e.kind),o.rtcp.cname=zr.getCname({offerMediaObject:a}),o.encodings=ro.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let h=0;h<o.encodings.length;++h)t[h]&&Object.assign(o.encodings[h],t[h]);if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8")for(let h of o.encodings)h.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:d,codecOptions:r});let p={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);let l=String(this._nextSendLocalId);this._nextSendLocalId++;let u=this._pc.getSenders().find(h=>h.track===e);return this._mapSendLocalIdRtpSender.set(l,u),{localId:l,rtpParameters:o,rtpSender:u}}async stopSending(e){this._assertSendDirection(),w.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);let r=await this._pc.createOffer();w.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(n){if(this._sendStream.getTracks().length===0){w.warn("stopSending() | ignoring expected error due no sending tracks: %s",n.toString());return}throw n}if(this._pc.signalingState==="stable")return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?w.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):w.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");let s=r.track;await r.replaceTrack(t),s&&this._sendStream.removeTrack(s),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),w.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");let s=r.getParameters();s.encodings.forEach((n,c)=>{c<=t?n.active=!0:n.active=!1}),await r.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),w.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");let s=r.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.setParameters(s)}async getSenderStats(e){this._assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n,priority:c};w.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%io.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=Se.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),w.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};w.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),w.debug("receive() [trackId:%s, kind:%s]",e,t);let s=e,n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});let c={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let a=await this._pc.createAnswer(),o=Se.parse(a.sdp),d=o.media.find(l=>String(l.mid)===n);zr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),a={type:"answer",sdp:Se.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),w.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);let p=this._pc.getReceivers().find(l=>l.track&&l.track.id===s);if(!p)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(s,{mid:n,rtpParameters:r,rtpReceiver:p}),{localId:s,track:p.track,rtpReceiver:p}}async stopReceiving(e){this._assertRecvDirection(),w.debug("stopReceiving() [localId:%s]",e);let{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});let s={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();w.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();let{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmitTime:c,maxRetransmits:a,protocol:r};w.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let p={type:"offer",sdp:this._remoteSdp.getSdp()};w.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=Se.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}w.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Se.parse(this._pc.localDescription.sdp));let r=zr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};ye.Chrome67=$r});var co=m(we=>{"use strict";var Ml=we&&we.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),xl=we&&we.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Qt=we&&we.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Ml(e,i,t);return xl(e,i),e};Object.defineProperty(we,"__esModule",{value:!0});we.Chrome55=void 0;var be=Qt(de()),Ol=A(),Xt=ce(),no=Qt($()),Ct=Qt(re()),Hr=Qt(qe()),ao=Qt(Jt()),Ll=pe(),Al=Fe(),E=new Ol.Logger("Chrome55"),oo={OS:1024,MIS:1024},Kr=class extends Ll.HandlerInterface{constructor(){super();this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Kr}get name(){return"Chrome55"}close(){if(E.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){E.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(n){}let r=be.parse(t.sdp);return Hr.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return E.debug("getNativeSctpCapabilities()"),{numStreams:oo}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){E.debug("run()"),this._direction=e,this._remoteSdp=new Al.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:Ct.getSendingRtpParameters("audio",p),video:Ct.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:Ct.getSendingRemoteRtpParameters("audio",p),video:Ct.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){E.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(E.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),E.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),s&&E.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let n=await this._pc.createOffer(),c=be.parse(n.sdp),a,o=no.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=Ct.reduceCodecs(o.codecs);let d=no.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=Ct.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:c}),e.kind==="video"&&t&&t.length>1&&(E.debug("send() | enabling simulcast"),c=be.parse(n.sdp),a=c.media.find(u=>u.type==="video"),ao.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),n={type:"offer",sdp:be.write(c)}),E.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),c=be.parse(this._pc.localDescription.sdp),a=c.media.find(u=>u.type===e.kind),o.rtcp.cname=Hr.getCname({offerMediaObject:a}),o.encodings=ao.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let u=0;u<o.encodings.length;++u)t[u]&&Object.assign(o.encodings[u],t[u]);if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8")for(let u of o.encodings)u.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:d,codecOptions:r});let p={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);let l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(l,e),{localId:l,rtpParameters:o}}async stopSending(e){this._assertSendDirection(),E.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);let r=await this._pc.createOffer();E.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(n){if(this._sendStream.getTracks().length===0){E.warn("stopSending() | ignoring expected error due no sending tracks: %s",n.toString());return}throw n}if(this._pc.signalingState==="stable")return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){throw new Xt.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new Xt.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new Xt.UnsupportedError("not supported")}async getSenderStats(e){throw new Xt.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n,priority:c};E.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%oo.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=be.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),E.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),E.debug("receive() [trackId:%s, kind:%s]",e,t);let s=e,n=t,c=r.rtcp.cname;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:c,trackId:e});let a={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let o=await this._pc.createAnswer(),d=be.parse(o.sdp),p=d.media.find(h=>String(h.mid)===n);Hr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:p}),o={type:"answer",sdp:be.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),E.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);let u=this._pc.getRemoteStreams().find(h=>h.id===c).getTrackById(s);if(!u)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(s,{mid:n,rtpParameters:r}),{localId:s,track:u}}async stopReceiving(e){this._assertRecvDirection(),E.debug("stopReceiving() [localId:%s]",e);let{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});let s={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();E.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new Xt.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmitTime:c,maxRetransmits:a,protocol:r};E.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let p={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=be.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=be.parse(this._pc.localDescription.sdp));let r=Hr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};we.Chrome55=Kr});var uo=m(Re=>{"use strict";var jl=Re&&Re.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Bl=Re&&Re.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Yt=Re&&Re.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&jl(e,i,t);return Bl(e,i),e};Object.defineProperty(Re,"__esModule",{value:!0});Re.Firefox60=void 0;var He=Yt(de()),ql=A(),Fl=ce(),ts=Yt($()),Et=Yt(re()),Gr=Yt(qe()),po=Yt(Ht()),Nl=pe(),Vl=Fe(),D=new ql.Logger("Firefox60"),lo={OS:16,MIS:2048},Jr=class extends Nl.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Jr}get name(){return"Firefox60"}close(){if(D.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){D.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");let s=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});let n=e.addTransceiver(s,{direction:"sendrecv"}),c=n.sender.getParameters(),a=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];c.encodings=a,await n.sender.setParameters(c);let o=await e.createOffer();try{t.remove()}catch(l){}try{s.stop()}catch(l){}try{e.close()}catch(l){}let d=He.parse(o.sdp);return Gr.extractRtpCapabilities({sdpObject:d})}catch(n){try{t.remove()}catch(c){}try{s.stop()}catch(c){}try{e.close()}catch(c){}throw n}}async getNativeSctpCapabilities(){return D.debug("getNativeSctpCapabilities()"),{numStreams:lo}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){D.debug("run()"),this._direction=e,this._remoteSdp=new Vl.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Et.getSendingRtpParameters("audio",p),video:Et.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:Et.getSendingRemoteRtpParameters("audio",p),video:Et.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){throw new Fl.UnsupportedError("not supported")}async restartIce(e){if(D.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});D.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};D.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};D.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();D.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),D.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=ts.clone(t,[]),t.length>1&&(t.forEach((h,f)=>{h.rid=`r${f}`}),t.reverse()));let n=ts.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=Et.reduceCodecs(n.codecs,s);let c=ts.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});c.codecs=Et.reduceCodecs(c.codecs,s);let a=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){let h=a.sender.getParameters();h.encodings=t,await a.sender.setParameters(h)}let o=await this._pc.createOffer(),d=He.parse(o.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),D.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);let p=a.mid;n.mid=p,d=He.parse(this._pc.localDescription.sdp);let l=d.media[d.media.length-1];if(n.rtcp.cname=Gr.getCname({offerMediaObject:l}),!t)n.encodings=po.getRtpEncodings({offerMediaObject:l});else if(t.length===1){let h=po.getRtpEncodings({offerMediaObject:l});Object.assign(h[0],t[0]),n.encodings=h}else n.encodings=t.reverse();if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let h of n.encodings)h.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,offerRtpParameters:n,answerRtpParameters:c,codecOptions:r,extmapAllowMixed:!0});let u={type:"answer",sdp:this._remoteSdp.getSdp()};return D.debug("send() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u),this._mapMidTransceiver.set(p,a),{localId:p,rtpParameters:n,rtpSender:a.sender}}async stopSending(e){D.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);let r=await this._pc.createOffer();D.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let s={type:"answer",sdp:this._remoteSdp.getSdp()};D.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?D.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):D.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),D.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");let s=r.sender.getParameters();t=s.encodings.length-1-t,s.encodings.forEach((n,c)=>{c>=t?n.active=!0:n.active=!1}),await r.sender.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),D.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.sender.setParameters(s)}async getSenderStats(e){this._assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n,priority:c};D.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%lo.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=He.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),D.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};D.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),D.debug("receive() [trackId:%s, kind:%s]",e,t);let s=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});let n={type:"offer",sdp:this._remoteSdp.getSdp()};D.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let c=await this._pc.createAnswer(),a=He.parse(c.sdp),o=a.media.find(p=>String(p.mid)===s);Gr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:o}),c={type:"answer",sdp:He.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:a}),D.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);let d=this._pc.getTransceivers().find(p=>p.mid===s);if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,d),{localId:s,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),D.debug("stopReceiving() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);let r={type:"offer",sdp:this._remoteSdp.getSdp()};D.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let s=await this._pc.createAnswer();D.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this._assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a,protocol:r};D.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let p={type:"offer",sdp:this._remoteSdp.getSdp()};D.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=He.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}D.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=He.parse(this._pc.localDescription.sdp));let r=Gr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Re.Firefox60=Jr});var go=m(Te=>{"use strict";var Ul=Te&&Te.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),zl=Te&&Te.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Zt=Te&&Te.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Ul(e,i,t);return zl(e,i),e};Object.defineProperty(Te,"__esModule",{value:!0});Te.Safari12=void 0;var Pe=Zt(de()),$l=A(),ho=Zt($()),Dt=Zt(re()),Wr=Zt(qe()),fo=Zt(Ht()),Hl=pe(),Kl=Fe(),T=new $l.Logger("Safari12"),mo={OS:1024,MIS:1024},Qr=class extends Hl.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Qr}get name(){return"Safari12"}close(){if(T.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){T.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch(n){}let r=Pe.parse(t.sdp);return Wr.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return T.debug("getNativeSctpCapabilities()"),{numStreams:mo}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){T.debug("run()"),this._direction=e,this._remoteSdp=new Kl.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n}),this._sendingRtpParametersByKind={audio:Dt.getSendingRtpParameters("audio",p),video:Dt.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:Dt.getSendingRemoteRtpParameters("audio",p),video:Dt.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){T.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(T.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),T.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let n=ho.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=Dt.reduceCodecs(n.codecs,s);let c=ho.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});c.codecs=Dt.reduceCodecs(c.codecs,s);let a=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]}),d=await this._pc.createOffer(),p=Pe.parse(d.sdp),l;this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:p}),t&&t.length>1&&(T.debug("send() | enabling legacy simulcast"),p=Pe.parse(d.sdp),l=p.media[a.idx],fo.addLegacySimulcast({offerMediaObject:l,numStreams:t.length}),d={type:"offer",sdp:Pe.write(p)}),T.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);let u=o.mid;if(n.mid=u,p=Pe.parse(this._pc.localDescription.sdp),l=p.media[a.idx],n.rtcp.cname=Wr.getCname({offerMediaObject:l}),n.encodings=fo.getRtpEncodings({offerMediaObject:l}),t)for(let f=0;f<n.encodings.length;++f)t[f]&&Object.assign(n.encodings[f],t[f]);if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let f of n.encodings)f.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:l,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:c,codecOptions:r});let h={type:"answer",sdp:this._remoteSdp.getSdp()};return T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(u,o),{localId:u,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection(),T.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);let r=await this._pc.createOffer();T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);let s={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?T.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):T.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),T.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{c<=t?n.active=!0:n.active=!1}),await r.sender.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),T.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");let s=r.sender.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.sender.setParameters(s)}async getSenderStats(e){this._assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n,priority:c};T.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%mo.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=Pe.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),T.debug("receive() [trackId:%s, kind:%s]",e,t);let s=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});let n={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let c=await this._pc.createAnswer(),a=Pe.parse(c.sdp),o=a.media.find(p=>String(p.mid)===s);Wr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:o}),c={type:"answer",sdp:Pe.write(a)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:a}),T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);let d=this._pc.getTransceivers().find(p=>p.mid===s);if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,d),{localId:s,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),T.debug("stopReceiving() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);let r={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let s=await this._pc.createAnswer();T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this._assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a,protocol:r};T.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let p={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=Pe.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Pe.parse(this._pc.localDescription.sdp));let r=Wr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Te.Safari12=Qr});var So=m(Ce=>{"use strict";var Gl=Ce&&Ce.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Jl=Ce&&Ce.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),er=Ce&&Ce.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Gl(e,i,t);return Jl(e,i),e};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.Safari11=void 0;var Ee=er(de()),Wl=A(),_o=er($()),kt=er(re()),Xr=er(qe()),vo=er(Jt()),Ql=pe(),Xl=Fe(),b=new Wl.Logger("Safari11"),yo={OS:1024,MIS:1024},Yr=class extends Ql.HandlerInterface{constructor(){super();this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Yr}get name(){return"Safari11"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(n){}let r=Ee.parse(t.sdp);return Xr.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:yo}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){b.debug("run()"),this._direction=e,this._remoteSdp=new Xl.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:kt.getSendingRtpParameters("audio",p),video:kt.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:kt.getSendingRemoteRtpParameters("audio",p),video:kt.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){b.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),s&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let n=await this._pc.createOffer(),c=Ee.parse(n.sdp),a,o=_o.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=kt.reduceCodecs(o.codecs);let d=_o.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=kt.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:c}),e.kind==="video"&&t&&t.length>1&&(b.debug("send() | enabling simulcast"),c=Ee.parse(n.sdp),a=c.media.find(h=>h.type==="video"),vo.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),n={type:"offer",sdp:Ee.write(c)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),c=Ee.parse(this._pc.localDescription.sdp),a=c.media.find(h=>h.type===e.kind),o.rtcp.cname=Xr.getCname({offerMediaObject:a}),o.encodings=vo.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let h=0;h<o.encodings.length;++h)t[h]&&Object.assign(o.encodings[h],t[h]);if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8")for(let h of o.encodings)h.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:d,codecOptions:r});let p={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);let l=String(this._nextSendLocalId);this._nextSendLocalId++;let u=this._pc.getSenders().find(h=>h.track===e);return this._mapSendLocalIdRtpSender.set(l,u),{localId:l,rtpParameters:o,rtpSender:u}}async stopSending(e){this._assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);let r=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(n){if(this._sendStream.getTracks().length===0){b.warn("stopSending() | ignoring expected error due no sending tracks: %s",n.toString());return}throw n}if(this._pc.signalingState==="stable")return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?b.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):b.debug("replaceTrack() [localId:%s, no track]",e);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");let s=r.track;await r.replaceTrack(t),s&&this._sendStream.removeTrack(s),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");let s=r.getParameters();s.encodings.forEach((n,c)=>{c<=t?n.active=!0:n.active=!1}),await r.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");let s=r.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.setParameters(s)}async getSenderStats(e){this._assertSendDirection();let t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n,priority:c};b.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%yo.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=Ee.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),b.debug("receive() [trackId:%s, kind:%s]",e,t);let s=e,n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});let c={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let a=await this._pc.createAnswer(),o=Ee.parse(a.sdp),d=o.media.find(l=>String(l.mid)===n);Xr.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),a={type:"answer",sdp:Ee.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);let p=this._pc.getReceivers().find(l=>l.track&&l.track.id===s);if(!p)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(s,{mid:n,rtpParameters:r,rtpReceiver:p}),{localId:s,track:p.track,rtpReceiver:p}}async stopReceiving(e){this._assertRecvDirection(),b.debug("stopReceiving() [localId:%s]",e);let{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});let s={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();let{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a,protocol:r};b.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let p={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=Ee.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ee.parse(this._pc.localDescription.sdp));let r=Xr.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Ce.Safari11=Yr});var bo=m(ne=>{"use strict";var Yl=ne&&ne.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Zl=ne&&ne.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),eu=ne&&ne.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Yl(e,i,t);return Zl(e,i),e};Object.defineProperty(ne,"__esModule",{value:!0});ne.mangleRtpParameters=ne.getCapabilities=void 0;var wo=eu($());function tu(){let i=RTCRtpReceiver.getCapabilities(),e=wo.clone(i,{});for(let t of e.codecs){if(t.channels=t.numChannels,delete t.numChannels,t.mimeType=t.mimeType||`${t.kind}/${t.name}`,t.parameters){let r=t.parameters;r.apt&&(r.apt=Number(r.apt)),r["packetization-mode"]&&(r["packetization-mode"]=Number(r["packetization-mode"]))}for(let r of t.rtcpFeedback||[])r.parameter||(r.parameter="")}return e}ne.getCapabilities=tu;function ru(i){let e=wo.clone(i,{});e.mid&&(e.muxId=e.mid,delete e.mid);for(let t of e.codecs)t.channels&&(t.numChannels=t.channels,delete t.channels),t.mimeType&&!t.name&&(t.name=t.mimeType.split("/")[1]),delete t.mimeType;return e}ne.mangleRtpParameters=ru});var Ro=m(De=>{"use strict";var iu=De&&De.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),su=De&&De.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),rs=De&&De.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&iu(e,i,t);return su(e,i),e};Object.defineProperty(De,"__esModule",{value:!0});De.Edge11=void 0;var nu=A(),is=ce(),Zr=rs($()),ss=rs(re()),ns=rs(bo()),au=pe(),k=new nu.Logger("Edge11"),ei=class extends au.HandlerInterface{constructor(){super();this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new ei}get name(){return"Edge11"}close(){k.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(let e of this._rtpSenders.values())try{e.stop()}catch(t){}for(let e of this._rtpReceivers.values())try{e.stop()}catch(t){}}async getNativeRtpCapabilities(){return k.debug("getNativeRtpCapabilities()"),ns.getCapabilities()}async getNativeSctpCapabilities(){return k.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){k.debug("run()"),this._sendingRtpParametersByKind={audio:ss.getSendingRtpParameters("audio",p),video:ss.getSendingRtpParameters("video",p)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=s,this._cname=`CNAME-${Zr.generateRandomNumber()}`,this._setIceGatherer({iceServers:c,iceTransportPolicy:a}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new is.UnsupportedError("not supported")}async restartIce(e){if(k.debug("restartIce()"),this._remoteIceParameters=e,!!this._transportReady){k.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(let t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){k.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),k.debug("send() | calling new RTCRtpSender()");let n=new RTCRtpSender(e,this._dtlsTransport),c=Zr.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=ss.reduceCodecs(c.codecs,s);let a=c.codecs.some(p=>/.+\/rtx$/i.test(p.mimeType));t||(t=[{}]);for(let p of t)p.ssrc=Zr.generateRandomNumber(),a&&(p.rtx={ssrc:Zr.generateRandomNumber()});c.encodings=t,c.rtcp={cname:this._cname,reducedSize:!0,mux:!0};let o=ns.mangleRtpParameters(c);k.debug("send() | calling rtpSender.send() [params:%o]",o),await n.send(o);let d=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(d,n),{localId:d,rtpParameters:c,rtpSender:n}}async stopSending(e){k.debug("stopSending() [localId:%s]",e);let t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{k.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(r){throw k.warn("stopSending() | rtpSender.stop() failed:%o",r),r}}async replaceTrack(e,t){t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e);let r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");let s=r.getParameters();s.encodings.forEach((n,c)=>{c<=t?n.active=!0:n.active=!1}),await r.setParameters(s)}async setRtpEncodingParameters(e,t){k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");let s=r.getParameters();s.encodings.forEach((n,c)=>{s.encodings[c]=Object.assign(Object.assign({},n),t)}),await r.setParameters(s)}async getSenderStats(e){let t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new is.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:r}){k.debug("receive() [trackId:%s, kind:%s]",e,t),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),k.debug("receive() | calling new RTCRtpReceiver()");let s=new RTCRtpReceiver(this._dtlsTransport,t);s.addEventListener("error",a=>{k.error('rtpReceiver "error" event [event:%o]',a)});let n=ns.mangleRtpParameters(r);k.debug("receive() | calling rtpReceiver.receive() [params:%o]",n),await s.receive(n);let c=e;return this._rtpReceivers.set(c,s),{localId:c,track:s.track,rtpReceiver:s}}async stopReceiving(e){k.debug("stopReceiving() [localId:%s]",e);let t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{k.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(r){k.warn("stopReceiving() | rtpReceiver.stop() failed:%o",r)}}async getReceiverStats(e){let t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new is.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){let r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",s=>{k.error('iceGatherer "error" event [event:%o]',s)});try{r.gather()}catch(s){k.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",s.toString())}this._iceGatherer=r}_setIceTransport(){let e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),e.addEventListener("candidatepairchange",t=>{k.debug('iceTransport "candidatepairchange" event [pair:%o]',t.pair)}),this._iceTransport=e}_setDtlsTransport(){let e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{k.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{k.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),e.state==="closed"&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",t=>{k.error('dtlsTransport "error" event [event:%o]',t)}),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){k.debug("_setupTransport()");let t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(let r of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(r);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(r=>r.algorithm==="sha-256"||r.algorithm==="sha-384"||r.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}};De.Edge11=ei});var Co=m(ke=>{"use strict";var ou=ke&&ke.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),cu=ke&&ke.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),tr=ke&&ke.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&ou(e,i,t);return cu(e,i),e};Object.defineProperty(ke,"__esModule",{value:!0});ke.ReactNative=void 0;var Ie=tr(de()),du=A(),rr=ce(),as=tr($()),It=tr(re()),ti=tr(qe()),To=tr(Jt()),pu=pe(),lu=Fe(),C=new du.Logger("ReactNative"),Po={OS:1024,MIS:1024},ri=class extends pu.HandlerInterface{constructor(){super();this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new ri}get name(){return"ReactNative"}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{let t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(n){}let r=Ie.parse(t.sdp);return ti.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(r){}throw t}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:Po}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){C.debug("run()"),this._direction=e,this._remoteSdp=new lu.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:It.getSendingRtpParameters("audio",p),video:It.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:It.getSendingRemoteRtpParameters("audio",p),video:It.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:c||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){C.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let r={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){this._assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),s&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let n=await this._pc.createOffer(),c=Ie.parse(n.sdp),a,o=as.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=It.reduceCodecs(o.codecs);let d=as.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(d.codecs=It.reduceCodecs(d.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:c}),e.kind==="video"&&t&&t.length>1&&(C.debug("send() | enabling simulcast"),c=Ie.parse(n.sdp),a=c.media.find(u=>u.type==="video"),To.addLegacySimulcast({offerMediaObject:a,track:e,numStreams:t.length}),n={type:"offer",sdp:Ie.write(c)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),c=Ie.parse(this._pc.localDescription.sdp),a=c.media.find(u=>u.type===e.kind),o.rtcp.cname=ti.getCname({offerMediaObject:a}),o.encodings=To.getRtpEncodings({offerMediaObject:a,track:e}),t)for(let u=0;u<o.encodings.length;++u)t[u]&&Object.assign(o.encodings[u],t[u]);if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let u of o.encodings)u.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:o,answerRtpParameters:d,codecOptions:r});let p={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setRemoteDescription(p);let l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(l,e),{localId:l,rtpParameters:o}}async stopSending(e){this._assertSendDirection(),C.debug("stopSending() [localId:%s]",e);let t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);let r=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(n){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",n.toString());return}throw n}if(this._pc.signalingState==="stable")return;let s={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){throw new rr.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new rr.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new rr.UnsupportedError("not implemented")}async getSenderStats(e){throw new rr.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:s,protocol:n,priority:c}){this._assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n,priority:c};C.debug("sendDataChannel() [options:%o]",a);let o=this._pc.createDataChannel(s,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Po.MIS,!this._hasDataChannelMediaSection){let p=await this._pc.createOffer(),l=Ie.parse(p.sdp),u=l.media.find(f=>f.type==="application");this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),this._remoteSdp.sendSctpAssociation({offerMediaObject:u});let h={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}let d={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:o,sctpStreamParameters:d}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),C.debug("receive() [trackId:%s, kind:%s]",e,t);let s=e,n=t,c=r.rtcp.cname;C.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),c+=`-hack-${as.generateRandomNumber()}`,this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:c,trackId:e});let a={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let o=await this._pc.createAnswer(),d=Ie.parse(o.sdp),p=d.media.find(h=>String(h.mid)===n);ti.applyCodecParameters({offerRtpParameters:r,answerMediaObject:p}),o={type:"answer",sdp:Ie.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);let u=this._pc.getRemoteStreams().find(h=>h.id===c).getTrackById(s);if(!u)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(s,{mid:n,rtpParameters:r}),{localId:s,track:u}}async stopReceiving(e){this._assertRecvDirection(),C.debug("stopReceiving() [localId:%s]",e);let{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});let s={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);let n=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new rr.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();let{streamId:s,ordered:n,maxPacketLifeTime:c,maxRetransmits:a}=e,o={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:c,maxRetransmitTime:c,maxRetransmits:a,protocol:r};C.debug("receiveDataChannel() [options:%o]",o);let d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});let p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);let l=await this._pc.createAnswer();if(!this._transportReady){let u=Ie.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),await this._pc.setLocalDescription(l),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Ie.parse(this._pc.localDescription.sdp));let r=ti.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};ke.ReactNative=ri});var os=m(W=>{"use strict";var uu=W&&W.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),hu=W&&W.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),Eo=W&&W.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&uu(e,i,t);return hu(e,i),e},fu=W&&W.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(W,"__esModule",{value:!0});W.Device=W.detectDevice=void 0;var mu=fu(oi()),gu=A(),_u=ze(),Mt=ce(),vu=Eo($()),Ke=Eo(re()),yu=Wi(),Su=Xa(),wu=eo(),bu=so(),Ru=co(),Tu=uo(),Pu=go(),Cu=So(),Eu=Ro(),Du=Co(),N=new gu.Logger("Device");function Do(){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(typeof RTCPeerConnection=="undefined"){N.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection");return}return N.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative"}else if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){let i=navigator.userAgent,e=mu.default.getParser(i),t=e.getEngine();if(e.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(e.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(e.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(e.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(e.satisfies({firefox:">=60"}))return"Firefox60";if(e.satisfies({safari:">=12.0"})&&typeof RTCRtpTransceiver!="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(e.satisfies({safari:">=11"}))return"Safari11";if(e.satisfies({"microsoft edge":">=11"})&&e.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(t.name&&t.name.toLowerCase()==="blink"){let r=i.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(r){let s=Number(r[1]);return s>=74?"Chrome74":s>=70?"Chrome70":s>=67?"Chrome67":"Chrome55"}else return"Chrome74"}else{N.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",e.getBrowserName(),e.getBrowserVersion());return}}else{N.warn("this._detectDevice() | unknown device");return}}W.detectDevice=Do;var ko=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new _u.EnhancedEventEmitter,N.debug("constructor()"),r)if(N.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),typeof r=="string")e=r;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)N.debug("constructor() | handler given: %s",e);else if(e=Do(),e)N.debug("constructor() | detected handler: %s",e);else throw new Mt.UnsupportedError("device not supported");switch(e){case"Chrome74":this._handlerFactory=Su.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=wu.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=bu.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=Ru.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=Tu.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=Pu.Safari12.createFactory();break;case"Safari11":this._handlerFactory=Cu.Safari11.createFactory();break;case"Edge11":this._handlerFactory=Eu.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=Du.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}let s=this._handlerFactory();this._handlerName=s.name,s.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new Mt.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new Mt.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){N.debug("load() [routerRtpCapabilities:%o]",e),e=vu.clone(e,void 0);let t;try{if(this._loaded)throw new Mt.InvalidStateError("already loaded");Ke.validateRtpCapabilities(e),t=this._handlerFactory();let r=await t.getNativeRtpCapabilities();N.debug("load() | got native RTP capabilities:%o",r),Ke.validateRtpCapabilities(r),this._extendedRtpCapabilities=Ke.getExtendedRtpCapabilities(r,e),N.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=Ke.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=Ke.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=Ke.getRecvRtpCapabilities(this._extendedRtpCapabilities),Ke.validateRtpCapabilities(this._recvRtpCapabilities),N.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),N.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),Ke.validateSctpCapabilities(this._sctpCapabilities),N.debug("load() succeeded"),this._loaded=!0,t.close()}catch(r){throw t&&t.close(),r}}canProduce(e){if(this._loaded){if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind "${e}"`)}else throw new Mt.InvalidStateError("not loaded");return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,appData:p={}}){return N.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,appData:p})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,appData:p={}}){return N.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:n,iceServers:c,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,appData:p})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:s,dtlsParameters:n,sctpParameters:c,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l={}}){if(this._loaded){if(typeof t!="string")throw new TypeError("missing id");if(typeof r!="object")throw new TypeError("missing iceParameters");if(Array.isArray(s)){if(typeof n!="object")throw new TypeError("missing dtlsParameters");if(c&&typeof c!="object")throw new TypeError("wrong sctpParameters");if(l&&typeof l!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new Mt.InvalidStateError("not loaded");let u=new yu.Transport({direction:e,id:t,iceParameters:r,iceCandidates:s,dtlsParameters:n,sctpParameters:c,iceServers:a,iceTransportPolicy:o,additionalSettings:d,proprietaryConstraints:p,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}};W.Device=ko});var Mo=m(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0})});var Oo=m(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0})});var Lo=m(V=>{"use strict";var ku=V&&V.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Me=V&&V.__exportStar||function(i,e){for(var t in i)t!=="default"&&!e.hasOwnProperty(t)&&ku(e,i,t)};Object.defineProperty(V,"__esModule",{value:!0});Me(os(),V);Me(Wi(),V);Me($i(),V);Me(Hi(),V);Me(Ki(),V);Me(Gi(),V);Me(Mo(),V);Me(Oo(),V);Me(pe(),V);Me(ce(),V)});var jo=m(q=>{"use strict";var Iu=q&&q.__createBinding||(Object.create?function(i,e,t,r){r===void 0&&(r=t),Object.defineProperty(i,r,{enumerable:!0,get:function(){return e[t]}})}:function(i,e,t,r){r===void 0&&(r=t),i[r]=e[t]}),Mu=q&&q.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),xu=q&&q.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.hasOwnProperty.call(i,t)&&Iu(e,i,t);return Mu(e,i),e};Object.defineProperty(q,"__esModule",{value:!0});q.detectDevice=q.Device=q.version=q.types=void 0;var Ao=os();Object.defineProperty(q,"Device",{enumerable:!0,get:function(){return Ao.Device}});Object.defineProperty(q,"detectDevice",{enumerable:!0,get:function(){return Ao.detectDevice}});var Ou=xu(Lo());q.types=Ou;q.version="3.6.29";var Lu=qr();Object.defineProperty(q,"parseScalabilityMode",{enumerable:!0,get:function(){return Lu.parse}})});var qo=m((yf,cs)=>{"use strict";var Au=Object.prototype.hasOwnProperty,H="~";function ir(){}Object.create&&(ir.prototype=Object.create(null),new ir().__proto__||(H=!1));function ju(i,e,t){this.fn=i,this.context=e,this.once=t||!1}function Bo(i,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var n=new ju(t,r||i,s),c=H?H+e:e;return i._events[c]?i._events[c].fn?i._events[c]=[i._events[c],n]:i._events[c].push(n):(i._events[c]=n,i._eventsCount++),i}function ii(i,e){--i._eventsCount==0?i._events=new ir:delete i._events[e]}function U(){this._events=new ir,this._eventsCount=0}U.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)Au.call(t,r)&&e.push(H?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};U.prototype.listeners=function(e){var t=H?H+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,n=r.length,c=new Array(n);s<n;s++)c[s]=r[s].fn;return c};U.prototype.listenerCount=function(e){var t=H?H+e:e,r=this._events[t];return r?r.fn?1:r.length:0};U.prototype.emit=function(e,t,r,s,n,c){var a=H?H+e:e;if(!this._events[a])return!1;var o=this._events[a],d=arguments.length,p,l;if(o.fn){switch(o.once&&this.removeListener(e,o.fn,void 0,!0),d){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,t),!0;case 3:return o.fn.call(o.context,t,r),!0;case 4:return o.fn.call(o.context,t,r,s),!0;case 5:return o.fn.call(o.context,t,r,s,n),!0;case 6:return o.fn.call(o.context,t,r,s,n,c),!0}for(l=1,p=new Array(d-1);l<d;l++)p[l-1]=arguments[l];o.fn.apply(o.context,p)}else{var u=o.length,h;for(l=0;l<u;l++)switch(o[l].once&&this.removeListener(e,o[l].fn,void 0,!0),d){case 1:o[l].fn.call(o[l].context);break;case 2:o[l].fn.call(o[l].context,t);break;case 3:o[l].fn.call(o[l].context,t,r);break;case 4:o[l].fn.call(o[l].context,t,r,s);break;default:if(!p)for(h=1,p=new Array(d-1);h<d;h++)p[h-1]=arguments[h];o[l].fn.apply(o[l].context,p)}}return!0};U.prototype.on=function(e,t,r){return Bo(this,e,t,r,!1)};U.prototype.once=function(e,t,r){return Bo(this,e,t,r,!0)};U.prototype.removeListener=function(e,t,r,s){var n=H?H+e:e;if(!this._events[n])return this;if(!t)return ii(this,n),this;var c=this._events[n];if(c.fn)c.fn===t&&(!s||c.once)&&(!r||c.context===r)&&ii(this,n);else{for(var a=0,o=[],d=c.length;a<d;a++)(c[a].fn!==t||s&&!c[a].once||r&&c[a].context!==r)&&o.push(c[a]);o.length?this._events[n]=o.length===1?o[0]:o:ii(this,n)}return this};U.prototype.removeAllListeners=function(e){var t;return e?(t=H?H+e:e,this._events[t]&&ii(this,t)):(this._events=new ir,this._eventsCount=0),this};U.prototype.off=U.prototype.removeListener;U.prototype.addListener=U.prototype.on;U.prefixed=H;U.EventEmitter=U;typeof cs!="undefined"&&(cs.exports=U)});var No=m((wf,ps)=>{var Fo=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);Fo?(ls=new Uint8Array(16),ps.exports=function(){return Fo(ls),ls}):(us=new Array(16),ps.exports=function(){for(var e=0,t;e<16;e++)(e&3)==0&&(t=Math.random()*4294967296),us[e]=t>>>((e&3)<<3)&255;return us});var ls,us});var hs=m((bf,Vo)=>{var Uo=[];for(var si=0;si<256;++si)Uo[si]=(si+256).toString(16).substr(1);function Bu(i,e){var t=e||0,r=Uo;return[r[i[t++]],r[i[t++]],r[i[t++]],r[i[t++]],"-",r[i[t++]],r[i[t++]],"-",r[i[t++]],r[i[t++]],"-",r[i[t++]],r[i[t++]],"-",r[i[t++]],r[i[t++]],r[i[t++]],r[i[t++]],r[i[t++]],r[i[t++]]].join("")}Vo.exports=Bu});var $o=m((Rf,zo)=>{var qu=No(),Fu=hs();function Nu(i,e,t){var r=e&&t||0;typeof i=="string"&&(e=i==="binary"?new Array(16):null,i=null),i=i||{};var s=i.random||(i.rng||qu)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e)for(var n=0;n<16;++n)e[r+n]=s[n];return e||Fu(s)}zo.exports=Nu});var Ko=m((Tf,Ho)=>{var Vu=hs();function Uu(i){var e=[];return i.replace(/[a-fA-F0-9]{2}/g,function(t){e.push(parseInt(t,16))}),e}function zu(i){i=unescape(encodeURIComponent(i));for(var e=new Array(i.length),t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}Ho.exports=function(i,e,t){var r=function(s,n,c,a){var o=c&&a||0;if(typeof s=="string"&&(s=zu(s)),typeof n=="string"&&(n=Uu(n)),!Array.isArray(s))throw TypeError("value must be an array of bytes");if(!Array.isArray(n)||n.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var d=t(n.concat(s));if(d[6]=d[6]&15|e,d[8]=d[8]&63|128,c)for(var p=0;p<16;++p)c[o+p]=d[p];return c||Vu(d)};try{r.name=i}catch(s){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}});var Jo=m((Pf,Go)=>{"use strict";function $u(i,e,t,r){switch(i){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function fs(i,e){return i<<e|i>>>32-e}function Hu(i){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof i=="string"){var r=unescape(encodeURIComponent(i));i=new Array(r.length);for(var s=0;s<r.length;s++)i[s]=r.charCodeAt(s)}i.push(128);for(var n=i.length/4+2,c=Math.ceil(n/16),a=new Array(c),s=0;s<c;s++){a[s]=new Array(16);for(var o=0;o<16;o++)a[s][o]=i[s*64+o*4]<<24|i[s*64+o*4+1]<<16|i[s*64+o*4+2]<<8|i[s*64+o*4+3]}a[c-1][14]=(i.length-1)*8/Math.pow(2,32),a[c-1][14]=Math.floor(a[c-1][14]),a[c-1][15]=(i.length-1)*8&4294967295;for(var s=0;s<c;s++){for(var d=new Array(80),p=0;p<16;p++)d[p]=a[s][p];for(var p=16;p<80;p++)d[p]=fs(d[p-3]^d[p-8]^d[p-14]^d[p-16],1);for(var l=t[0],u=t[1],h=t[2],f=t[3],_=t[4],p=0;p<80;p++){var g=Math.floor(p/20),M=fs(l,5)+$u(g,u,h,f)+_+e[g]+d[p]>>>0;_=f,f=h,h=fs(u,30)>>>0,u=l,l=M}t[0]=t[0]+l>>>0,t[1]=t[1]+u>>>0,t[2]=t[2]+h>>>0,t[3]=t[3]+f>>>0,t[4]=t[4]+_>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}Go.exports=Hu});var Qo=m((Cf,Wo)=>{var Ku=Ko(),Gu=Jo();Wo.exports=Ku("v5",80,Gu)});var Yo=m(sr=>{"use strict";var Xo=sr&&sr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(sr,"__esModule",{value:!0});var Ju=Xo($o()),Wu=Xo(Qo()),tt=function(){return Ju.default()};tt.regex={v4:/^(?:[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12})|(?:0{8}-0{4}-0{4}-0{4}-0{12})$/u,v5:/^(?:[a-f0-9]{8}-[a-f0-9]{4}-5[a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12})|(?:0{8}-0{4}-0{4}-0{4}-0{12})$/u};tt.is=function(i){return tt.regex.v4.test(i)||tt.regex.v5.test(i)};tt.empty=function(){return"00000000-0000-0000-0000-000000000000"};tt.fromString=function(i){let e="bb5d0ffa-9a4c-4d7c-8fc2-0a7d2220ba45";return Wu.default(i,e)};sr.default=tt});var Zo=Lt(oi());var br=Lt(Ln()),Mh=br.default.Manager;var An={apiEndpoint:"https://ws.metered.ca"};var ms=Lt(jo()),ec=Lt(qo());var Ge;(function(i){i.audio="audio",i.video="video"})(Ge||(Ge={}));var ds=class{constructor(){this.remoteStreams=[];this.localStreams=[]}addRemoteStream(e){let t=!1;for(let r=0;r<this.remoteStreams.length;r++)this.remoteStreams[r].streamId===e.streamId&&(t=!0);t||this.remoteStreams.push(e)}removeRemoteStream(e){for(let t=0;t<this.remoteStreams.length;t++)this.remoteStreams[t].streamId===e&&this.remoteStreams.splice(t,1)}getAllRemoteAudioStream(){var e=[];for(let t of this.remoteStreams)t.type==="audio"&&e.push(t);return e}getAllRemoteVideoStream(){let e=[];for(let t of this.remoteStreams)t.type==="video"&&e.push(t);return e}addLocalStream(e){let t=!1;for(let r=0;r<this.localStreams.length;r++)this.localStreams[r].streamId===e.streamId&&(t=!0);t||this.localStreams.push(e)}updateLocalStreamTrack(e,t){for(let r=0;r<this.localStreams.length;r++)this.localStreams[r].streamId===e&&(this.localStreams[r].track=t)}removeLocalStream(e){for(let t=0;t<this.localStreams.length;t++)this.localStreams[t].streamId===e&&this.localStreams.splice(t,1)}getAllLocalAudioStream(){var e=[];for(let t of this.localStreams)t.type==="audio"&&e.push(t);return e}getAllLocalVideoStream(){let e=[];for(let t of this.localStreams)t.type==="video"&&e.push(t);return e}};var xt=Lt(Yo()),P;(function(i){i.NotJoined="not_joined",i.Joining="joining",i.ConnectingStreams="connecting_streams",i.Joined="joined",i.Terminated="terminated"})(P||(P={}));var gs=class extends ec.EventEmitter{constructor(e,t){super();this.meetingState=P.NotJoined;this.accessToken="";this.roomUrl="";this.meetingSessionId="";this.participantSessionId="";this.roomId="";this.audioOnly=!1;this.participantInfo=null;this.defaultVideoConstraints={video:{width:{ideal:1280},height:{ideal:720},frameRate:20,deviceId:null}};this.chatRoomURL="";this.audioProducer=null;this.videoProducer=null;this._selectedAudioInputDevice="";this._selectedAudioOutputDevice="";this._selectedVideoInputDevice="";this.sharingAudio=!1;this.sharingVideo=!1;this.sharingScreen=!1;this.disabledAudio=!1;this.disabledVideo=!1;this.disabledScreenSharing=!1;this.socket=null;this.device=null;this.handlerName=null;this.sendTransport=null;this.receiveTransport=null;this._onlineParticipants=[];this.videoTagCount=0;this.socket=(0,br.default)(An.apiEndpoint,{transports:["websocket"],secure:!0}),this.handlerName=ms.default.detectDevice(),this.device=new ms.default.Device,this.store=new ds}get selectedAudioInputDevice(){return this._selectedAudioInputDevice}get selectedAudioOutputDevice(){return this._selectedAudioOutputDevice}get selectedVideoInputDevice(){return this._selectedVideoInputDevice}getOnlineParticipants(){return this._onlineParticipants}async requestAudioPermission(){let e=await navigator.mediaDevices.getUserMedia({audio:!0});for(let t of e.getTracks())t.stop();return!0}async requestVideoPermission(){let e=await navigator.mediaDevices.getUserMedia({video:!0});for(let t of e.getTracks())t.stop();return!0}startHeartbeatManager(){this.meetingState===P.Joined&&(this.socket.emit("heartbeat",{participantSessionId:this.participantSessionId}),this.socket.emit("heartbeat",{participantSessionId:this.participantSessionId}),this.socket.emit("heartbeat",{participantSessionId:this.participantSessionId}),this.heartbeatInterval=setInterval(()=>{this.socket.emit("heartbeat",{participantSessionId:this.participantSessionId})},1e4))}stopHeartbeatManager(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}handleTransportEvents(){this.sendTransport.on("connect",async(e,t)=>{this.socket.emit("connectTransport",{transportId:this.sendTransport.id,dtlsParameters:e.dtlsParameters}),t()}),this.receiveTransport.on("connect",async(e,t)=>{this.socket.emit("connectTransport",{transportId:this.receiveTransport.id,dtlsParameters:e.dtlsParameters}),t()}),this.sendTransport.on("produce",async(e,t)=>{this.socket.emit("createProducer",{transportId:this.sendTransport.id,kind:e.kind,rtpParameters:e.rtpParameters,type:e.appData.type,streamId:e.appData.streamId,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId}),this.socket.once("createProducerSuccess",r=>{r=JSON.parse(r),t({id:r.producerId})})})}async handleSocketEvents(){this.socket.io.on("reconnect_failed",()=>{this.meetingState=P.Terminated,this.emit("stateChanged",P.Terminated),this.emit("meetingLeft")}),this.socket.on("reconnectError",async e=>{this.meetingState=P.Terminated,this.emit("stateChanged",P.Terminated)}),this.socket.on("reconnectSuccess",async e=>{this._onlineParticipants=e.onlineParticipants,this.emit("onlineParticipants",e.onlineParticipants)}),this.socket.on("rtpParameters",async e=>{e=JSON.parse(e),await this.device.load({routerRtpCapabilities:e.rtpCapabilities}),this.socket.emit("createTransports",{roomId:this.roomId,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId})}),this.socket.on("consumerCreated",async e=>{e=JSON.parse(e);let t=await this.receiveTransport.consume({id:e.consumerId,producerId:e.producerId,kind:e.kind,rtpParameters:e.rtpParameters}),r={};try{for(let s of this._onlineParticipants)s._id===e.producerParticipantSessionId&&(r=s)}catch(s){}e.composed?(this.emit("composedTrackStarted",{streamId:e.streamId,track:t.track,participantSessionId:e.producerParticipantSessionId,participant:r,type:e.type,isComposedStream:!0}),this.store.addRemoteStream({streamId:e.streamId,consumer:t,remoteProducerId:e.producerId,participantSessionId:e.producerParticipantSessionId,type:e.type,track:t.track,isComposedStream:!0})):(this.emit("remoteTrackStarted",{streamId:e.streamId,track:t.track,participantSessionId:e.producerParticipantSessionId,participant:r,type:e.type,isComposedStream:!1}),this.store.addRemoteStream({streamId:e.streamId,consumer:t,remoteProducerId:e.producerId,participantSessionId:e.producerParticipantSessionId,type:e.type,track:t.track,isComposedStream:!1})),this.socket.emit("resumeConsumer",{consumerId:t.id})}),this.socket.on("removeStream",async e=>{this.store.removeRemoteStream(e.streamId),this.emit("remoteTrackStopped",{streamId:e.streamId,participantSessionId:e.participantSessionId,type:e.type})}),this.socket.on("meetingEnded",async e=>{this.stopHeartbeatManager(),this.meetingState=P.Terminated,this.emit("stateChanged",P.Terminated),this.socket&&this.socket.off(),this.emit("meetingEnded")}),this.socket.on("participantLeft",async e=>{for(let t=0;t<this._onlineParticipants.length;t++)this._onlineParticipants[t]._id===e._id&&this._onlineParticipants.splice(t,1);e._id===this.participantSessionId&&this.leaveMeeting(),this.emit("onlineParticipants",this._onlineParticipants),this.emit("participantLeft",e)}),this.socket.on("participantJoined",async e=>{let t=!1;for(let r=0;r<this._onlineParticipants.length;r++)this._onlineParticipants[r]._id===e._id&&(t=!0);t||this._onlineParticipants.push(e),this.emit("onlineParticipants",this._onlineParticipants),this.emit("participantJoined",e)}),this.socket.on("activeSpeaker",async e=>{this.emit("activeSpeaker",e)}),this.socket.on("participantSharingStateUpdated",async e=>{this.emit("participantSharingStateUpdated",e)}),this.socket.on("disableParticipantAudio",async e=>{console.log(e),this.emit("disableParticipantAudio",e),this.disabledAudio=!0,this.socket.emit("participantSharingStateUpdated",{sharingAudio:!1,disabledAudio:!0,disabledVideo:this.disabledVideo,sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,action:"disabledParticipantAudio"})}),this.socket.on("disableParticipantVideo",async e=>{console.log(e),this.emit("disableParticipantVideo",e),this.disabledVideo=!0,this.socket.emit("participantSharingStateUpdated",{sharingAudio:this.sharingAudio,sharingVideo:!1,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledVideo:!0,disabledAudio:this.disabledAudio,action:"disableParticipantVideo"})}),this.socket.on("enableParticipantAudio",async e=>{console.log(e),this.emit("enableParticipantAudio",e),this.disabledAudio=!1,this.socket.emit("participantSharingStateUpdated",{sharingAudio:!1,disabledAudio:!1,disabledVideo:this.disabledVideo,sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,action:"enabledParticipantAudio"})}),this.socket.on("enableParticipantVideo",async e=>{console.log(e),this.emit("enableParticipantVideo",e),this.disabledVideo=!1,this.socket.emit("participantSharingStateUpdated",{sharingAudio:this.sharingAudio,sharingVideo:!1,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledVideo:!1,disabledAudio:this.disabledAudio,action:"enabledParticipantVideo"})}),this.socket.on("newMeetingAccessRequest",async e=>{console.log("newMeetingAccessRequest",e),this.emit("newMeetingAccessRequest",e)})}_getChatRoomURL(){return this.chatRoomURL}join(e){let t=Zo.default.getParser(window.navigator.userAgent);return new Promise((r,s)=>{if(this.meetingState==P.Terminated)throw new Error("Meeting terminated. Please create a new meeting object");if(this.meetingState===P.Joined)return r({roomId:this.roomId,meetingSessionId:this.meetingSessionId,participantSessionId:this.participantSessionId,onlineParticipants:this._onlineParticipants,participantInfo:this.participantInfo,accessToken:this.accessToken});if(this.meetingState===P.Joining||this.meetingState===P.ConnectingStreams)throw new Error("already in the process of joining meeting");if(e.accessToken&&(this.accessToken=e.accessToken),e.roomURL)this.roomUrl=e.roomURL;else throw new Error("roomUrl is required");if(!e.name&&!e.accessToken)throw new Error("please specify name or accessToken");this.socket.removeAllListeners(),this.handleSocketEvents(),this.meetingState=P.Joining,this.emit("stateChanged",P.Joining),this.socket.io.on("reconnect",()=>{this.socket.emit("reconnectMeeting",{roomURL:e.roomURL,accessToken:this.accessToken})}),this.socket.emit("joinMeeting",{roomURL:e.roomURL,name:e.name?e.name:void 0,accessToken:e.accessToken?e.accessToken:void 0,composerKey:e.composerKey?e.composerKey:void 0,receiveVideoStreamType:e.receiveVideoStreamType?e.receiveVideoStreamType:void 0,receiveAudioStreamType:e.receiveAudioStreamType?e.receiveAudioStreamType:void 0,browser:t.getBrowserName(),browserVersion:t.getBrowserVersion(),os:t.getOSName(),osVersion:t.getOSVersion(),platform:t.getPlatformType()}),this.socket.once("joinMeetingError",n=>{this.meetingState=P.NotJoined,this.emit("stateChanged",P.NotJoined),s(n)}),this.socket.on("joinMeetingSuccess",n=>{this.meetingState=P.ConnectingStreams,this.emit("stateChanged",P.ConnectingStreams),this.roomId=n.roomId,this.meetingSessionId=n.meetingSessionId,this.participantSessionId=n.participantSessionId,this._onlineParticipants=n.onlineParticipants,this.accessToken=n.accessToken,n.audioOnly&&n.audioOnly==!0&&(this.audioOnly=!0),this.participantInfo=n.participantInfo,this.chatRoomURL=n.chatRoomURL,this.emit("joinMeetingSuccess",{meetingSessionId:this.meetingSessionId,participantSessionId:this.participantSessionId,roomId:this.roomId,accessToken:this.accessToken}),this.emit("onlineParticipants",n.onlineParticipants)}),this.socket.on("createTransportsError",async n=>{n=JSON.parse(n),this.meetingState=P.NotJoined,this.emit("stateChanged",P.NotJoined),s(n)}),this.socket.on("createTransportsSuccess",async n=>(n=JSON.parse(n),this.sendTransport=this.device.createSendTransport({id:n.sendTransport.id,iceParameters:n.sendTransport.iceParameters,iceCandidates:n.sendTransport.iceCandidates,dtlsParameters:n.sendTransport.dtlsParameters,sctpParameters:n.sendTransport.sctpParameters,iceServers:[{urls:["turn:relay1.metered.ca:80?transport=tcp","turn:relay1.metered.ca:443?transport=tcp"],username:"639b693c74aedc15",credential:"7566bd5cda6bcf81"},{urls:["turn:relay1.metered.ca:443"],username:"639b693c74aedc15",credential:"7566bd5cda6bcf81"},{urls:["stun:relay1.metered.ca:80"]}]}),this.receiveTransport=this.device.createRecvTransport({id:n.receiveTransport.id,iceParameters:n.receiveTransport.iceParameters,iceCandidates:n.receiveTransport.iceCandidates,dtlsParameters:n.receiveTransport.dtlsParameters,sctpParameters:n.receiveTransport.sctpParameters,iceServers:[{urls:["turn:relay1.metered.ca:80?transport=tcp","turn:relay1.metered.ca:443?transport=tcp"],username:"639b693c74aedc15",credential:"7566bd5cda6bcf81"},{urls:["turn:relay1.metered.ca:443"],username:"639b693c74aedc15",credential:"7566bd5cda6bcf81"},{urls:["stun:relay1.metered.ca:80"]}]}),this.handleTransportEvents(),this.socket.emit("createConsumers",{userRtpCapabilities:this.device.rtpCapabilities}),this.meetingState=P.Joined,this.emit("stateChanged",P.Joined),this.startHeartbeatManager(),r({roomId:this.roomId,meetingSessionId:this.meetingSessionId,participantSessionId:this.participantSessionId,onlineParticipants:this._onlineParticipants,participantInfo:this.participantInfo,accessToken:this.accessToken})))})}leaveMeeting(){this.socket.emit("leaveMeeting",{participantSessionId:this.participantSessionId}),this.stopHeartbeatManager(),this.meetingState=P.Terminated,this.emit("stateChanged",P.Terminated),this.socket&&this.socket.off();try{let e=this.store.getAllLocalVideoStream(),t=this.store.getAllLocalAudioStream();if(e&&e.length>0)for(let r of e)r.track.stop();if(t&&t.length>0)for(let r of t)r.track.stop()}catch(e){}this.emit("meetingLeft")}requestMeetingAccess(e){if(!e.roomURL&&!this.roomUrl)throw new Error("roomURL has to be provided");return new Promise((t,r)=>{this.socket.emit("requestMeetingAccess",{name:e.name,roomURL:e.roomURL||this.roomUrl}),this.socket.once("requestMeetingAccessSuccess",s=>{t(s)}),this.socket.once("requestMeetingAccessFailed",s=>{r(s)})})}async listAudioInputDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("Enumeration not supported");var e=await navigator.mediaDevices.getUserMedia({audio:!0});for(let s of e.getTracks())s.stop();let t=await navigator.mediaDevices.enumerateDevices(),r=[];for(let s of t)s.kind==="audioinput"&&r.push(s);return r}async listAudioOutputDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("Enumeration not supported");var e=await navigator.mediaDevices.getUserMedia({audio:!0});for(let s of e.getTracks())s.stop();let t=await navigator.mediaDevices.enumerateDevices(),r=[];for(let s of t)s.kind==="audiooutput"&&r.push(s);return r}async listVideoInputDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("Enumeration not supported");var e=await navigator.mediaDevices.getUserMedia({video:!0});for(let s of e.getTracks())s.stop();let t=await navigator.mediaDevices.enumerateDevices(),r=[];for(let s of t)s.kind==="videoinput"&&r.push(s);return r}async chooseAudioInputDevice(e){await this.requestAudioPermission();var t=await this.listAudioInputDevices(),r=!1;for(let s of t)e==s.deviceId&&(r=!0);if(!r)throw new Error("Invalid device id");if(this._selectedAudioInputDevice=e,this.meetingState==P.Joined&&this.audioProducer){let s=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this._selectedAudioInputDevice}});this.audioProducer.replaceTrack({track:s.getTracks()[0]});let n=this.store.getAllLocalAudioStream();n[0]&&(this.store.updateLocalStreamTrack(n[0].streamId,s.getTracks()[0]),this.emit("localTrackUpdated",{type:"audio",streamId:n[0].streamId,track:s.getTracks()[0]}))}}async chooseAudioOutputDevice(e){await this.requestAudioPermission();var t=await this.listAudioOutputDevices(),r=!1,s=!1;for(let n of t)e==n.deviceId&&(r=!0);if(!r)throw new Error("Invalid device id");this._selectedAudioInputDevice!==e&&(s=!0),this._selectedAudioOutputDevice=e,setInterval(async()=>{let n=document.getElementsByTagName("video");if(this.videoTagCount!==n.length||s){for(let c of n)await c.setSinkId(e);this.videoTagCount=n.length,s=!1}},1e3)}async chooseVideoInputDevice(e){await this.requestVideoPermission();var t=await this.listVideoInputDevices(),r=!1;for(let s of t)e==s.deviceId&&(r=!0);if(!r)throw new Error("Invalid device id");if(this._selectedVideoInputDevice=e,this.meetingState===P.Joined&&this.videoProducer){let s=this.defaultVideoConstraints;s.video.deviceId=this._selectedVideoInputDevice;let n=await navigator.mediaDevices.getUserMedia(s);this.videoProducer.replaceTrack({track:n.getTracks()[0]});let c=this.store.getAllLocalVideoStream();c[0]&&(this.store.updateLocalStreamTrack(c[0].streamId,n.getTracks()[0]),this.emit("localTrackUpdated",{type:"video",streamId:c[0].streamId,track:n.getTracks()[0]})),this.sharingScreen=!1,this.sharingVideo=!0}}async getLocalVideoStream(){return await navigator.mediaDevices.getUserMedia({video:this._selectedVideoInputDevice?{deviceId:this._selectedVideoInputDevice}:!0})}async getLocalAudioStream(){return await navigator.mediaDevices.getUserMedia({audio:this._selectedAudioInputDevice?{deviceId:this._selectedAudioInputDevice}:!0})}async getCurrentlySharedVideoStream(){let e=this.store.getAllLocalVideoStream();if(e.length>0){let t=new MediaStream;return t.addTrack(e[0].track),t}else return null}async startAudio(){if(this.meetingState!==P.Joined)throw new Error("meeting not joined or in the joining state. Please call the join method and wait for it to resolve before calling this method");if(this.store.getAllLocalAudioStream().length>0)throw new Error("audio stream already started");if(this.sharingAudio)throw new Error("audio sharing in process");this.sharingAudio=!0;let t=null;try{let s=(await navigator.mediaDevices.getUserMedia({audio:this._selectedAudioInputDevice?{deviceId:this._selectedAudioInputDevice,echoCancellation:!1}:{echoCancellation:!1}})).getAudioTracks()[0];t=(0,xt.default)(),this.audioProducer=await this.sendTransport.produce({track:s,appData:{type:"audio",streamId:t}}),this.store.addLocalStream({streamId:t,producer:this.audioProducer,participantSessionId:this.participantSessionId,track:s,type:Ge.audio}),this.emit("localTrackStarted",{type:"audio",streamId:t,track:s}),this.socket.emit("participantSharingStateUpdated",{sharingAudio:this.sharingAudio,sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingAudio"})}catch(r){throw this.sharingAudio=!1,t&&this.store.removeLocalStream(t),r}}async startVideo(){if(this.meetingState!==P.Joined)throw new Error("meeting not joined or in the joining state. Please call the join method and wait for it to resolve before calling this method");if(this.sharingVideo)throw new Error("video sharing in process");if(this.audioOnly)throw new Error("Cannot share video in an audio only room");if(this.sharingScreen){let e=this.defaultVideoConstraints;this._selectedVideoInputDevice?e.video.deviceId=this._selectedVideoInputDevice:delete e.video.deviceId;let r=(await navigator.mediaDevices.getUserMedia(e)).getVideoTracks()[0];this.videoProducer.replaceTrack({track:r});let s=this.store.getAllLocalVideoStream();s[0]&&(this.store.updateLocalStreamTrack(s[0].streamId,r),this.emit("localTrackUpdated",{type:"video",streamId:s[0].streamId,track:r})),this.sharingVideo=!0,this.sharingScreen=!1,this.socket.emit("participantSharingStateUpdated",{sharingScreen:this.sharingScreen,sharingVideo:this.sharingVideo,sharingAudio:this.sharingAudio,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingVideo"})}else{let e=null;try{let t=this.defaultVideoConstraints;this._selectedVideoInputDevice?t.video.deviceId=this._selectedVideoInputDevice:delete t.video.deviceId;let s=(await navigator.mediaDevices.getUserMedia(t)).getVideoTracks()[0];e=(0,xt.default)(),this.videoProducer=await this.sendTransport.produce({track:s,encodings:[{rid:"r0",scaleResolutionDownBy:4},{rid:"r1",scaleResolutionDownBy:1}],appData:{type:"video",streamId:e}}),this.store.addLocalStream({streamId:e,producer:this.videoProducer,track:s,type:Ge.video,participantSessionId:this.participantSessionId}),this.emit("localTrackStarted",{type:"video",streamId:e,track:s}),this.sharingVideo=!0,this.sharingScreen=!1,this.socket.emit("participantSharingStateUpdated",{sharingScreen:this.sharingScreen,sharingVideo:this.sharingVideo,sharingAudio:this.sharingAudio,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingVideo"})}catch(t){throw this.sharingVideo=!1,e&&this.store.removeRemoteStream(e),t}}}muteLocalAudio(){let e=this.store.getAllLocalAudioStream();for(let t of e)t.track.enabled=!1}unmuteLocalAudio(){let e=this.store.getAllLocalAudioStream();for(let t of e)t.track.enabled=!0}resumeLocalVideo(){let e=this.store.getAllLocalVideoStream();for(let t of e)t.track.enabled=!0}pauseLocalVideo(){let e=this.store.getAllLocalVideoStream();for(let t of e)t.track.enabled=!1}stopAudio(){let e=this.store.getAllLocalAudioStream();for(let t of e)t.producer.close(),this.socket.emit("closeProducer",{producerId:t.producer.id,streamId:t.streamId,participantSessionId:this.participantSessionId}),this.emit("localTrackStopped",{streamId:t.streamId,track:t.track,type:t.type}),this.store.removeLocalStream(t.streamId),this.sharingAudio=!1,this.socket.emit("participantSharingStateUpdated",{sharingAudio:this.sharingAudio,sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"stoppedSharingAudio"})}stopVideo(){let e=this.store.getAllLocalVideoStream();for(let t of e){t.producer.close(),this.socket.emit("closeProducer",{producerId:t.producer.id,streamId:t.streamId,participantSessionId:this.participantSessionId}),this.emit("localTrackStopped",{streamId:t.streamId,track:t.track,type:t.type}),this.store.removeLocalStream(t.streamId);let r="";this.sharingScreen&&(r="stoppedSharingScreen"),this.sharingVideo&&(r="stoppedSharingVideo"),this.sharingScreen=!1,this.sharingVideo=!1,this.socket.emit("participantSharingStateUpdated",{sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,sharingAudio:this.sharingAudio,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:r})}}async startScreenShare(){if(this.meetingState!==P.Joined)throw new Error("meeting not joined or in the joining state. Please call the join method and wait for it to resolve before calling this method");if(this.audioOnly)throw new Error("Cannot share screen in an audio only meeting");if(!navigator.mediaDevices.getDisplayMedia)throw new Error("Screen capture not supported");var e={video:{cursor:"always",frameRate:5},audio:!1};if(this.sharingVideo){let t=null;try{t=await navigator.mediaDevices.getDisplayMedia(e),this.videoProducer.replaceTrack({track:t.getTracks()[0]});let r=this.store.getAllLocalVideoStream();r[0]&&(this.store.updateLocalStreamTrack(r[0].streamId,t.getTracks()[0]),this.emit("localTrackUpdated",{type:"video",streamId:r[0].streamId,track:t.getTracks()[0]})),this.sharingVideo=!1,this.sharingScreen=!0,this.socket.emit("participantSharingStateUpdated",{sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,sharingAudio:this.sharingAudio,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingScreen"});try{let s=t.getVideoTracks()[0];t.getVideoTracks()[0].onended=()=>{this.emit("localTrackStopped",{type:"video",streamId:r[0].streamId,track:s})}}catch(s){}return t}catch(r){throw r}}else{let t=null;try{let r=await navigator.mediaDevices.getDisplayMedia(e),s=r.getVideoTracks()[0];t=(0,xt.default)(),this.videoProducer=await this.sendTransport.produce({track:s,appData:{type:"video",streamId:t}});try{s.onended=()=>{this.emit("localTrackStopped",{type:"video",streamId:t,track:s})}}catch(n){}return this.store.addLocalStream({streamId:t,producer:this.videoProducer,track:s,type:Ge.video,participantSessionId:this.participantSessionId}),this.emit("localTrackStarted",{type:"video",streamId:t,track:s}),this.sharingVideo=!1,this.sharingScreen=!0,this.socket.emit("participantSharingStateUpdated",{sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,sharingAudio:this.sharingAudio,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingScreen"}),r}catch(r){throw this.sharingVideo=!1,t&&this.store.removeRemoteStream(t),r}}}async shareCustomAudio(e){if(this.meetingState!==P.Joined)throw new Error("meeting not joined or in the joining state. Please call the join method and wait for it to resolve before calling this method");this.sharingAudio=!0;let t=null;try{let r=e.getAudioTracks()[0];this.audioProducer?this.audioProducer.replaceTrack({track:r}):(t=(0,xt.default)(),this.audioProducer=await this.sendTransport.produce({track:r,appData:{type:"audio",streamId:t}}),this.store.addLocalStream({streamId:t,producer:this.audioProducer,participantSessionId:this.participantSessionId,track:r,type:Ge.audio}),this.emit("localTrackStarted",{type:"audio",streamId:t,track:r}),this.socket.emit("participantSharingStateUpdated",{sharingAudio:this.sharingAudio,sharingVideo:this.sharingVideo,sharingScreen:this.sharingScreen,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingAudio"}))}catch(r){throw this.sharingAudio=!1,t&&this.store.removeLocalStream(t),r}}async shareCustomVideoStream(e){if(this.meetingState!==P.Joined)throw new Error("meeting not joined or in the joining state. Please call the join method and wait for it to resolve before calling this method");if(this.sharingVideo)throw new Error("video sharing in process");if(this.audioOnly)throw new Error("Cannot share video in an audio only room");let t=null;try{let r=e.getVideoTracks()[0];t=(0,xt.default)(),this.videoProducer=await this.sendTransport.produce({track:r,encodings:[{rid:"r0",scaleResolutionDownBy:4},{rid:"r1",scaleResolutionDownBy:2},{rid:"r2",scaleResolutionDownBy:1}],appData:{type:"video",streamId:t}}),this.store.addLocalStream({streamId:t,producer:this.videoProducer,track:r,type:Ge.video,participantSessionId:this.participantSessionId}),this.emit("localTrackStarted",{type:"video",streamId:t,track:r}),this.sharingVideo=!0,this.sharingScreen=!1,this.socket.emit("participantSharingStateUpdated",{sharingScreen:this.sharingScreen,sharingVideo:this.sharingVideo,sharingAudio:this.sharingAudio,participantSessionId:this.participantSessionId,meetingSessionId:this.meetingSessionId,disabledAudio:this.disabledAudio,disabledVideo:this.disabledVideo,action:"startedSharingVideo"})}catch(r){throw this.sharingVideo=!1,t&&this.store.removeRemoteStream(t),r}}sendChatMessage(e){}sendFile(e){}},tc=gs;var rc={Meeting:tc},jf=rc;window&&(window.Metered=rc);})();